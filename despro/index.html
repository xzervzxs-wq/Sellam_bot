<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ุงุณุชูุฏูู ุงููุตูููู | Studio</title>
    
    <!-- ููุชุจุงุช ุงูุชูุณูู ูุงูุฎุทูุท -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html-to-image/1.11.11/html-to-image.min.js"></script>
    <!-- ุฅุถุงูุฉ ููุชุจุฉ jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- ุฅุถุงูุฉ ููุชุจุฉ UTIF ููุฑุงุกุฉ ูููุงุช TIF -->
    <script src="https://cdn.jsdelivr.net/npm/utif@3.1.0/UTIF.js"></script>
    <!-- ุฅุถุงูุฉ ููุชุจุฉ PDF.js ููุฑุงุกุฉ ูููุงุช PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    
    <!-- ุชุญููู ุจูุงูุงุช ุงูุฃุตูู ูู GitHub - ูุชู ุนุจุฑ fetch -->
    <!-- ุณูุชู ุชุญููู official3.json ุนุจุฑ JavaScript -->
    
    <!-- ููุชุจุฉ ุงูุฃููููุงุช -->
    <link id="fa-stylesheet" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">
    
    <!-- ุชุญููู ุงูุฎุทูุท ุงูุนุฑุจูุฉ (ููุชุจุฉ ููุณุนุฉ - 37 ุฎุท) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Akatab:wght@400;700&family=Alexandria:wght@400;700&family=Almarai:wght@400;700&family=Amiri:wght@400;700&family=Aref+Ruqaa:wght@400;700&family=Baloo+Bhaijaan+2:wght@400;700&family=Blaka&family=Blaka+Hollow&family=Blaka+Ink&family=Cairo:wght@400;700&family=Changa:wght@400;700&family=El+Messiri:wght@400;700&family=Gulzar&family=Harmattan:wght@400;700&family=IBM+Plex+Sans+Arabic:wght@400;700&family=Katibeh&family=Kufam:wght@400;700&family=Lalezar&family=Lateef:wght@400;700&family=Lemonada:wght@400;700&family=Mada:wght@400;700&family=Marhey:wght@400;700&family=Markazi+Text:wght@400;700&family=Mirza:wght@400;700&family=Noto+Kufi+Arabic:wght@400;700&family=Noto+Sans+Arabic:wght@400;700&family=Noto+Serif+Arabic:wght@400;700&family=Rakkas&family=Readex+Pro:wght@400;700&family=Reem+Kufi:wght@400;700&family=Rubik:wght@400;700&family=Scheherazade+New:wght@400;700&family=Tajawal:wght@400;700&family=Vazirmatn:wght@400;700&family=Zain:wght@400;700&display=swap" rel="stylesheet" crossorigin="anonymous">

    <script>
        // ุฅุนุฏุงุฏ PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
    </script>

    <!-- Stylesheet ุฎุงุฑุฌู -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body class="min-h-screen" onclick="deselect(event); closeShapesDropdown(); closeFramesDropdown();">

    <!-- ุชุญููู ุงูุฎุทูุท -->
    <div id="hidden-font-loader">
        <span style="font-family: 'Amiri', serif;">ุฃ</span>
        <!-- ... (ุจุงูู ุงูุฎุทูุท) ... -->
        <span style="font-family: 'Tajawal', sans-serif;">ุฃ</span>
    </div>

    <!-- ุดุงุดุฉ ุชุณุฌูู ุงูุฏุฎูู -->
    <div id="login-overlay" style="display: none;">
        <div class="login-container" style="position: relative;">
            <button onclick="toggleLoginOverlay()" style="position: absolute; top: 8px; right: 10px; background: none; border: none; color: #6366f1; font-size: 12px; cursor: pointer; transition: all 0.3s ease; padding: 5px 8px; font-family: 'Cairo', sans-serif; font-weight: bold;" title="ุงูุนูุฏุฉ">
                <i class="fas fa-arrow-right" style="margin-left: 4px;"></i>
                back
            </button>
            <div class="login-title">๐จ ุงุณุชูุฏูู ุงููุตูููู</div>
            <div style="text-align: center; font-size: 14px; color: #94a3b8; font-family: 'Cairo', sans-serif; margin-bottom: 20px;">
                ุงุณุชูุฏูู ูุชุฎุตุต | ูุณุงุญุงุช ููุฅุจุฏุงุน โจ
            </div>
            <div class="login-subtitle">ุฃุฏุฎู ุงูููุฏ ุงูุฎุงุต ุจู</div>
            <input 
                type="text" 
                id="login-code-input" 
                class="login-input" 
                placeholder="ุงูููุฏ" 
                autocomplete="off"
                onkeypress="if(event.key==='Enter') verifyCode()"
            >
            <button id="login-btn" class="login-btn" onclick="verifyCode()">ุฏุฎูู</button>
            <div class="login-loading" id="login-loading">
                <div class="login-spinner"></div>
            </div>
            <div class="login-error" id="login-error"></div>
            
            <!-- ูุณู ุงูุฎุฏูุงุช -->
            <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
                <p style="font-size: 12px; color: #64748b; font-family: 'Cairo', sans-serif; margin-bottom: 14px; text-align: center; font-weight: bold;">
                    ุชูุงุตู ูุนูุง ุนุจุฑ ูุงุชุณ ุงุจ
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                    <!-- ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงู -->
                    <a href="subscriptions.html" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 10px; background-color: #6366f1; color: white; border-radius: 8px; text-decoration: none; font-size: 11px; font-weight: bold; font-family: 'Cairo', sans-serif; transition: all 0.3s ease; border: none; cursor: pointer;">
                        <i class="fas fa-credit-card" style="font-size: 16px;"></i>
                        ุฅุฏุงุฑุฉ ุงูุงุดุชุฑุงู
                    </a>
                    
                    <!-- ุงูุงูุชุฑุงุญุงุช -->
                    <a href="https://wa.me/966531333714?text=ูุฏู%20ุงูุชุฑุงุญ" target="_blank" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 10px; background-color: #6366f1; color: white; border-radius: 8px; text-decoration: none; font-size: 11px; font-weight: bold; font-family: 'Cairo', sans-serif; transition: all 0.3s ease; border: none; cursor: pointer;">
                        <i class="fas fa-lightbulb" style="font-size: 16px;"></i>
                        ุงูุงูุชุฑุงุญุงุช
                    </a>
                    
                    <!-- ุงูุฏุนู ุงูููู -->
                    <a href="https://wa.me/966531333714?text=ุฃุญุชุงุฌ%20ุฅูู%20ุฏุนู%20ููู" target="_blank" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 10px; background-color: #6366f1; color: white; border-radius: 8px; text-decoration: none; font-size: 11px; font-weight: bold; font-family: 'Cairo', sans-serif; transition: all 0.3s ease; border: none; cursor: pointer;">
                        <i class="fas fa-headset" style="font-size: 16px;"></i>
                        ุงูุฏุนู ุงูููู
                    </a>
                    
                    <!-- ุงุณุชูุณุงุฑุงุช -->
                    <a href="https://wa.me/966531333714?text=ูุฏู%20ุงุณุชูุณุงุฑ" target="_blank" style="display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 4px; padding: 10px; background-color: #6366f1; color: white; border-radius: 8px; text-decoration: none; font-size: 11px; font-weight: bold; font-family: 'Cairo', sans-serif; transition: all 0.3s ease; border: none; cursor: pointer;">
                        <i class="fas fa-question-circle" style="font-size: 16px;"></i>
                        ุงุณุชูุณุงุฑุงุช
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงูุชูุจูู (ููุชุญููู ุงูุฏุงุฎูู) -->
    <div id="startup-overlay" style="display: none;">
        <div class="spinner mb-4"></div>
        <div class="loading-text">ุฌุงุฑู ุชุฌููุฒ ุงุณุชูุฏูู ุงููุตูููู...</div>
    </div>
    
    <!-- ูุงูุฐุฉ ุงูุฃุตูู ุงูุนุงุฆูุฉ -->
    <div id="asset-window">
        <div id="asset-header">
            <span>๐จ ุนูุงุตุฑ ุงููุงูุจ</span>
            <button onclick="document.getElementById('asset-window').style.display='none'" class="text-white hover:text-red-400"><i class="fas fa-times"></i></button>
        </div>
        <div id="asset-content">
            <!-- ุณูุชู ุชุนุจุฆุฉ ุงูุนูุงุตุฑ ููุง -->
        </div>
    </div>

    <!-- ุดุงุดุฉ ุงูุชุตุฏูุฑ -->
    <div id="export-overlay"><div class="spinner mb-4"></div><div class="text-white font-bold text-xl">ุฌุงุฑู ุฅูุดุงุก ุงูุตูุฑุฉ...</div></div>
    
    <!-- ูุงูุฐุฉ ุงูุชูุจูู ุงูุฌูููุฉ (ุงููุตุบุฑุฉ) -->
    <div id="info-modal" style="display: none; position: fixed; inset: 0; background: rgba(15, 23, 42, 0.4); z-index: 100001; align-items: center; justify-content: center; backdrop-filter: blur(2px);">
        <div class="bg-white/95 backdrop-blur rounded-2xl shadow-2xl border border-indigo-100 p-4 max-w-[280px] mx-4 text-center transform animate-bounce-in relative">
            
            <div class="flex items-center gap-2 justify-center mb-2 border-b border-gray-100 pb-2">
                <div id="info-modal-icon" class="text-xl">๐ก</div>
                <h3 id="info-modal-title" class="text-sm font-bold text-slate-800">ุชูุจูู</h3>
            </div>
            
            <p id="info-modal-message" class="text-slate-600 text-xs font-semibold mb-3 leading-relaxed"></p>
            
            <button onclick="closeInfoModal()" class="w-full bg-[#6366f1] text-white hover:bg-[#4f46e5] px-4 py-1.5 rounded-lg text-xs font-bold transition shadow-md hover:shadow-lg">
                ุญุณูุงู
            </button>
        </div>
    </div>
    
    <div id="save-modal">
        <div class="w-full h-full max-w-[95vw] md:max-w-6xl max-h-[95vh] bg-slate-900 rounded-2xl shadow-2xl flex overflow-hidden border border-slate-700 mx-4">
            
            <!-- ุงููุณู ุงูุฃููู: ุงููุนุงููุฉ -->
            <div class="flex-1 bg-[#0f172a] relative p-6 flex items-center justify-center">
                <!-- ุฎูููุฉ ุดุจููุฉ ุฎูููุฉ -->
                <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(#6366f1 1px, transparent 1px); background-size: 20px 20px;"></div>
                
                <div class="relative shadow-2xl h-full w-full flex items-center justify-center z-10 pb-4">
                    <img id="save-img" class="max-h-full max-w-full object-contain bg-white transition-transform duration-300 shadow-xl" alt="ูุนุงููุฉ ุงูุทุจุงุนุฉ">
                </div>
            </div>

            <!-- ุงููุณู ุงูุฃูุณุฑ: ุงูุฎูุงุฑุงุช -->
            <div class="w-[320px] bg-slate-800 border-r border-slate-700 flex flex-col z-20 shadow-xl">
                 <!-- ุฑุฃุณ ุงููุงุฆูุฉ -->
                 <div class="p-6 pb-4 border-b border-slate-700/50">
                     <h2 class="text-xl font-extrabold text-white mb-1 flex items-center gap-2">
                        <i class="fas fa-print text-[#6366f1]"></i> ุทุจุงุนุฉ ูุชุตุฏูุฑ
                     </h2>
                     <p class="text-slate-400 text-[11px] font-bold">ูุนุงููุฉ ูุชุฎุตูุต ุทุจุงุนุฉ A4</p>
                 </div>
                 
                 <!-- ุงููุญุชูู ุงููุงุจู ููุชูุฑูุฑ -->
                 <div class="flex-1 overflow-y-auto p-6 space-y-6">
                     
                     <!-- ุฅุนุฏุงุฏุงุช ุงููุณุฎ -->
                     <div class="bg-slate-700/30 p-4 rounded-xl border border-slate-600/50">
                         <div class="flex items-center justify-between mb-3">
                             <label class="text-slate-200 text-xs font-bold"><i class="fas fa-copy ml-1"></i> ุนุฏุฏ ุงููุณุฎ:</label>
                             <span class="text-sm text-slate-200 font-bold bg-slate-600/70 px-3 py-1 rounded-full" id="a4-max-text"></span>
                         </div>
                         
                         <div class="flex items-center gap-2">
                             <input type="text" inputmode="numeric" id="a4-count" class="w-full bg-slate-900 border border-slate-600 rounded-lg h-10 text-center font-bold text-white text-lg focus:ring-1 focus:ring-[#6366f1] focus:border-[#6366f1] outline-none transition" oninput="this.value = arabicToEnglish(this.value); updateA4Count()" min="1">
                         </div>
                     </div>

                     <!-- ุฎูุงุฑุงุช ุฅุถุงููุฉ -->
                     <div class="bg-slate-700/30 p-4 rounded-xl border border-slate-600/50 space-y-3">
                         <label class="flex items-center justify-between cursor-pointer group select-none">
                             <div class="flex items-center gap-2">
                                 <div class="w-8 h-8 rounded-full bg-slate-600/50 flex items-center justify-center group-hover:bg-[#6366f1] transition duration-300 text-white">
                                     <i class="fas fa-scissors text-xs"></i>
                                 </div>
                                 <span class="text-slate-200 text-xs font-bold group-hover:text-white transition">ููุงุตู ุงููุต</span>
                             </div>
                             <div class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" id="show-cut-lines" checked onchange="updateA4Count()" class="sr-only peer">
                                <div class="w-9 h-5 bg-slate-600 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-[#6366f1]"></div>
                             </div>
                         </label>
                         
                         <!-- Opacity Control for Cut Lines -->
                         <div class="px-1 pt-2 pb-1">
                             <div class="flex items-center gap-2">
                                 <span class="text-[8px] text-slate-400 font-bold whitespace-nowrap">ุงูุดูุงููุฉ:</span>
                                 <input type="range" id="cut-lines-opacity" min="10" max="100" value="100" onchange="updateA4Count()" oninput="document.getElementById('opacity-value').innerText = this.value + '%'" class="flex-1 h-1.5 accent-[#6366f1] rounded-full" style="cursor: pointer;">
                                 <span class="text-[8px] text-slate-400 font-bold w-5 text-right" id="opacity-value">100%</span>
                             </div>
                         </div>
                     </div>

                     <!-- ููุงุญุธุฉ -->
                     <div class="bg-blue-500/10 border border-blue-500/20 rounded-lg p-3">
                         <p class="text-[10px] text-blue-200 leading-relaxed font-bold flex gap-2">
                             <i class="fas fa-info-circle mt-0.5"></i>
                             ูุชู ุชุฑุชูุจ ุงูุจุทุงูุงุช ุชููุงุฆูุงู ูุงุณุชุบูุงู ูุณุงุญุฉ ุงููุฑูุฉ ุจุงููุงูู.
                         </p>
                     </div>
                 </div>

                 <!-- ุฐูู ุงููุงุฆูุฉ (ุงูุฃุฒุฑุงุฑ) -->
                 <div class="p-6 pt-4 border-t border-slate-700/50 bg-slate-800 flex flex-col gap-3">
                     <button onclick="printDesignDirect()" class="w-full bg-gradient-to-r from-[#6366f1] to-[#4f46e5] text-white py-3.5 rounded-xl font-bold hover:shadow-lg hover:shadow-[#6366f1]/25 border border-white/10 active:scale-[0.98] transition flex items-center justify-center gap-2 group">
                        <i class="fas fa-print text-lg group-hover:animate-pulse"></i> <span>ุทุจุงุนุฉ ููุฑูุฉ</span>
                     </button>
                     
                     <div class="grid grid-cols-2 gap-3">
                         <button onclick="downloadImage()" class="bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-bold transition flex items-center justify-center gap-2 text-xs border border-white/5 active:scale-[0.98]">
                            <i class="fas fa-image text-emerald-400"></i> ุตูุฑุฉ
                         </button>
                         <button onclick="downloadPDF()" class="bg-slate-700 hover:bg-slate-600 text-white py-3 rounded-xl font-bold transition flex items-center justify-center gap-2 text-xs border border-white/5 active:scale-[0.98]">
                            <i class="fas fa-file-pdf text-red-400"></i> PDF
                         </button>
                     </div>

                     <button onclick="closeA4Modal()" class="mt-3 text-slate-300 hover:text-white text-xs font-bold py-2 px-4 transition text-center hover:bg-slate-700/50 rounded-lg border border-slate-600 hover:border-slate-500">
                         ุฅุบูุงู ุงููุงูุฐุฉ
                     </button>
                     
                     <div id="premium-badge" class="text-center mt-3 flex items-center justify-center gap-2">
                         <i class="fas fa-gem text-pink-400 text-sm"></i>
                         <div class="flex flex-col gap-0.5">
                             <p class="text-[9px] text-slate-400 font-medium">ุฎุงุต ุจูุดุชุฑููู</p>
                             <p class="text-[10px] text-pink-300 font-bold">PREMIUM</p>
                         </div>
                     </div>
                     
                     <script>
                         // ุฅุฎูุงุก ูุต ุงูุจุฑููููู ููุฃุนุถุงุก ุงูุจุฑููููู
                         function updatePremiumBadge() {
                             const badge = document.getElementById('premium-badge');
                             if (userTier === 'premium' && badge) {
                                 badge.style.display = 'none';
                             } else if (badge) {
                                 badge.style.display = 'flex';
                             }
                         }
                         // ุชุญุฏูุซ ุนูุฏ ูุชุญ ุงููุงูุฐุฉ
                         const observer = new MutationObserver(() => updatePremiumBadge());
                         observer.observe(document.getElementById('save-modal'), { attributes: true });
                         setTimeout(updatePremiumBadge, 100);
                     </script>
                 </div>
            </div>
            
            <!-- ุฒุฑ ูุฏูู ูุฎูู ููุญูุงุธ ุนูู ุงูุชูุงูู -->
            <button id="btn-modal-a4" onclick="generateA4Sheet()" class="hidden"></button>
        </div>
    </div>

    <!-- ููุฏุงู ุงููุดุฑูุน ุงูุฌุฏูุฏ - ูุงุนู ูุฎููู ูุน ููู ูุฑุฏู -->
    <div id="new-project-modal" class="hidden fixed inset-0 bg-black/40 z-50 flex items-center justify-center" onclick="if(event.target.id === 'new-project-modal') closeNewProjectModal()">
        <div class="bg-white rounded-2xl p-5 shadow-lg max-w-sm w-full mx-4" onclick="event.stopPropagation()">
            <!-- ุงูุฑุฃุณ ุงูุจุณูุท -->
            <div class="text-center mb-4">
                <h2 class="text-lg font-bold text-[#1e293b]">ูู ุชุฑูุฏ ุญูุธ ุงูุนููุ</h2>
                <p class="text-xs text-[#94a3b8] mt-1">ูุฏูู ุนูู ุญุงูู ูู ูุชู ุญูุธู</p>
            </div>
            
            <!-- ุงูุฃุฒุฑุงุฑ ุงูุซูุงุซ ุจุฌุงูุจ ุจุนุถ -->
            <div class="flex gap-2 justify-center">
                <button onclick="saveCurrentAsTemplateAndNew()" class="flex-1 bg-[#ec4899] text-white px-3 py-2.5 rounded-lg text-xs font-bold hover:bg-[#db2777] transition-all shadow-sm flex items-center justify-center gap-2 group">
                    <i class="fas fa-save group-hover:scale-110 transition-transform"></i>
                    <span>ุญูุธ ุงูุนูู</span>
                </button>
                
                <button onclick="resetCanvasWithoutSave()" class="flex-1 bg-white border border-[#ef4444] text-[#ef4444] px-3 py-2.5 rounded-lg text-xs font-bold hover:bg-[#fef2f2] hover:border-[#dc2626] transition-all shadow-sm flex items-center justify-center gap-2 group">
                    <i class="fas fa-trash-alt group-hover:scale-110 transition-transform"></i>
                    <span>ุนุฏู ุงูุญูุธ</span>
                </button>
                
                <button onclick="closeNewProjectModal()" class="flex-1 bg-white border border-[#cbd5e1] text-[#64748b] px-3 py-2.5 rounded-lg text-xs font-bold hover:bg-[#f8fafc] hover:border-[#94a3b8] transition-all shadow-sm flex items-center justify-center gap-2 group">
                    <i class="fas fa-times group-hover:scale-110 transition-transform"></i>
                    <span>ุฅูุบุงุก</span>
                </button>
            </div>
        </div>
    </div>

    <!-- ููุฏุงู ุญูุธ ุจุงุณู - ูุงุนู ูุฎููู ูุน ููู ูุฑุฏู -->
    <div id="save-as-modal" class="hidden fixed inset-0 bg-black/40 z-50 flex items-center justify-center" onclick="if(event.target.id === 'save-as-modal') closeSaveAsModal()">
        <div class="bg-white rounded-2xl p-5 shadow-lg max-w-sm w-full mx-4" onclick="event.stopPropagation()">
            <!-- ุงูุฑุฃุณ ุงูุจุณูุท -->
            <div class="text-center mb-4">
                <h2 class="text-lg font-bold text-[#1e293b] flex items-center justify-center gap-2">
                    <i class="fas fa-save text-[#ec4899]"></i>
                    <span>ุญูุธ ุงูุนูู</span>
                </h2>
                <p class="text-xs text-[#94a3b8] mt-1">ุงุญูุธ ุนููู ููุงูุจ ูุญููุธ</p>
            </div>
            
            <!-- ุญูู ุงูุงุณู -->
            <div class="mb-4">
                <label class="text-xs font-bold text-[#1e293b] block mb-2">ุงุณู ุงูุนูู:</label>
                <input type="text" id="save-as-name" placeholder="ุฃุฏุฎู ุงุณู ุงูุนูู..." class="w-full px-3 py-2.5 border border-[#e2e8f0] rounded-lg text-sm outline-none focus:border-[#6366f1] focus:bg-[#f0f9ff] text-[#1e293b] transition-all" />
                <p class="text-xs text-[#94a3b8] mt-1.5">๐ก ุณูุชู ุญูุธ ุฌููุน ุนูุงุตุฑ ุงูุนูู</p>
            </div>
            
            <!-- ุฎูุงุฑ ุญูุธ ุงูููุงุญุธุงุช (ูุธูุฑ ููุท ุฅุฐุง ููุฌุฏุช ููุงุญุธุงุช) -->
            <div id="save-notes-option" class="hidden mb-4">
                <!-- ูููุดุชุฑููู ุงูุจุฑููููู -->
                <label id="notes-option-premium" class="flex items-center gap-2 cursor-pointer p-2.5 bg-[#fef3c7] border border-[#fbbf24] rounded-lg hover:bg-[#fef9c3] transition-all">
                    <input type="checkbox" id="save-with-notes" class="w-4 h-4 accent-[#f59e0b] cursor-pointer" checked />
                    <span class="text-xs font-bold text-[#92400e] flex items-center gap-1">
                        <i class="fas fa-sticky-note"></i>
                        ุญูุธ ูุน ุงูููุงุญุธุงุช
                    </span>
                </label>
                <!-- ูููุดุชุฑููู ุงููุฌุงูููู -->
                <div id="notes-option-free" class="hidden flex items-center gap-2 p-2.5 bg-[#f1f5f9] border border-[#cbd5e1] rounded-lg opacity-60 cursor-not-allowed">
                    <input type="checkbox" disabled class="w-4 h-4 accent-gray-400 cursor-not-allowed" />
                    <span class="text-xs font-bold text-[#64748b] flex items-center gap-1">
                        <i class="fas fa-sticky-note"></i>
                        ุญูุธ ูุน ุงูููุงุญุธุงุช
                    </span>
                    <span class="text-xs font-bold text-[#f59e0b] mr-auto flex items-center gap-1">
                        <i class="fas fa-crown"></i>
                        Premium Members
                    </span>
                </div>
            </div>
            
            <!-- ุงูุฃุฒุฑุงุฑ -->
            <div class="flex gap-2 justify-center mb-3">
                <button onclick="executeSaveAsFile()" class="flex-1 bg-[#ec4899] text-white px-3 py-2.5 rounded-lg text-xs font-bold hover:bg-[#db2777] transition-all shadow-sm flex items-center justify-center gap-2 group">
                    <i class="fas fa-save group-hover:scale-110 transition-transform"></i>
                    <span>ุญูุธ ุงูุขู</span>
                </button>
                <button onclick="closeSaveAsModal()" class="flex-1 bg-white border border-[#cbd5e1] text-[#64748b] px-3 py-2.5 rounded-lg text-xs font-bold hover:bg-[#f8fafc] hover:border-[#94a3b8] transition-all shadow-sm flex items-center justify-center gap-2 group">
                    <i class="fas fa-times group-hover:scale-110 transition-transform"></i>
                    <span>ุฅูุบุงุก</span>
                </button>
            </div>

            <!-- ููุงุญุธุฉ ุตุบูุฑุฉ ูุน ุฃููููุฉ -->
            <div class="bg-[#f0f9ff] border border-[#bfdbfe] rounded-lg p-2.5 text-center">
                <p class="text-xs text-[#1e40af] font-medium">
                    <i class="fas fa-check-circle ml-1"></i> ุณูุชู ุญูุธ ุงูุนูู ูู ุฌูุงุฒู ูุญููุงู
                </p>
            </div>
            <input type="hidden" id="save-as-callback">
        </div>
    </div>

    <!-- ููุฏุงู ุงููุฌุงุญ - ูุงุนู ูุนุตุฑู -->
    <div id="success-modal" class="hidden fixed inset-0 bg-black/40 z-[60] flex items-center justify-center backdrop-blur-sm transition-all duration-300 opacity-0" onclick="closeSuccessModal()">
        <div class="bg-white rounded-2xl p-6 shadow-2xl max-w-[300px] w-full mx-4 transform transition-all duration-300 scale-90" id="success-modal-content" onclick="event.stopPropagation()">
            <div class="text-center">
                <div class="w-14 h-14 bg-green-50 rounded-full flex items-center justify-center mx-auto mb-3 shadow-inner">
                    <i class="fas fa-check text-2xl text-green-500 animate-pulse"></i>
                </div>
                <h2 class="text-base font-bold text-[#1e293b] mb-1" id="success-modal-title">ุชูุช ุงูุนูููุฉ</h2>
                <p class="text-[11px] text-[#64748b] mb-5 leading-relaxed" id="success-modal-message">ุชู ุชูููุฐ ุงูุฅุฌุฑุงุก ุงููุทููุจ ุจูุฌุงุญ</p>
                <button onclick="closeSuccessModal()" class="w-full bg-[#ec4899] text-white px-4 py-2.5 rounded-xl text-xs font-bold hover:bg-[#db2777] transition-all shadow-md flex items-center justify-center gap-2 group hover:shadow-lg hover:-translate-y-0.5">
                    <span>ุญุณูุงู</span>
                </button>
            </div>
        </div>
    </div>


    <!-- ููุฏุงู ุงูุชุฏุฑุฌ ุงููููู - ุชู ุฅูุบุงุคู ูุงุณุชุจุฏุงูู ุจุฃุฏูุงุช ูู ุงูุดุฑูุท ุงูุนููู -->


    <!-- ูุงุฌูุฉ ุงูุชุทุจูู -->
    <div class="max-w-7xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-12 gap-6 h-screen-lg">
        
        <!-- ุงูููุญุฉ ุงูุฌุงูุจูุฉ -->
        <div class="lg:col-span-4 bg-white p-5 rounded-2xl shadow-md border border-[#cbd5e1] flex flex-col gap-4 h-fit" onclick="event.stopPropagation()">
            <div class="flex items-center justify-between border-b border-[#e2e8f0] pb-3">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-[#6366f1] rounded-xl flex items-center justify-center text-white shadow-md transform rotate-3"><i class="fas fa-palette text-lg"></i></div>
                    <div>
                        <h1 id="studio-name-display" class="font-bold text-[#1e293b] text-2xl">ุฃุณุชูุฏูู <span style="color: #6366f1;">Despro</span></h1>
                        <p class="text-[10px] text-[#94a3b8] font-bold" style="font-family: 'Noto Serif Arabic', serif;">ูุณุงุญุฉ ูุฎุตุตุฉ <span style="color: #6366f1; margin: 0 2px;">|</span> ูุชุงุฌุฑ <span style="color: #6366f1; margin: 0 2px;">|</span> ูุดุงุฑูุน ููุฒููุฉ ุตุบูุฑู <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; vertical-align: middle; margin-left: 2px;"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M21 12l-9 -9l-9 9h2v7a2 2 0 0 0 2 2h6" /><path d="M9 21v-6a2 2 0 0 1 2 -2h2c.39 0 .754 .112 1.061 .304" /><path d="M19 21.5l2.518 -2.58a1.74 1.74 0 0 0 0 -2.413a1.627 1.627 0 0 0 -2.346 0l-.168 .172l-.168 -.172a1.627 1.627 0 0 0 -2.346 0a1.74 1.74 0 0 0 0 2.412l2.51 2.59l0 -.009" /></svg></p>
                    </div>
                </div>
                <!-- ุฒุฑ ุชุจุฏูู ุงููุถุน ุงููููู ูุงูููุงุฑู -->
                <button id="theme-toggle-btn" onclick="toggleDarkMode()" class="theme-toggle-btn" title="ุชุจุฏูู ุงููุถุน ุงููููู">
                    <svg class="theme-sun" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-sun-moon" style="background-color: #6366f1; border-radius: 50%; padding: 4px;"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9.173 14.83a4 4 0 1 1 5.657 -5.657" /><path d="M11.294 12.707l.174 .247a7.5 7.5 0 0 0 8.845 2.492a9 9 0 0 1 -14.671 2.914" /><path d="M3 12h1" /><path d="M12 3v1" /><path d="M5.6 5.6l.7 .7" /><path d="M3 21l18 -18" /></svg>
                    <i class="fas fa-moon theme-moon"></i>
                </button>
            </div>

            <!-- ุฅุถุงูุฉ ุงููุตูุต -->
            <div id="add-text-container" class="space-y-2 bg-[#f8fafc] p-3 rounded-xl border border-[#e2e8f0]">
                <label class="text-xs font-bold text-[#1e293b]">ุฅุถุงูุฉ ูุตูุต</label>
                <div class="flex flex-col gap-2">
                    <textarea id="user-text-input" rows="2" placeholder="ุงูุชุจ ุงููุต ููุง..." class="w-full p-2 bg-white border border-[#cbd5e1] rounded-lg text-sm outline-none focus:border-[#6366f1] text-[#1e293b] resize-none"></textarea>
                    <button onclick="addUserText()" class="bg-[#6366f1] text-white px-4 py-2 rounded-lg hover:bg-[#4f46e5] flex items-center justify-center border border-[#6366f1] text-sm font-bold shadow-sm w-full">
                        <i class="fas fa-plus ml-2"></i> ุฅุถุงูุฉ ุงููุต
                    </button>
                </div>
            </div>

            <!-- ุฃุฏูุงุช ุงูุฅุถุงูุฉ -->
            <div class="grid grid-cols-3 gap-2">
                <label class="col-span-2 bg-white border border-dashed border-[#6366f1] py-3 rounded-lg text-[#1e293b] hover:bg-[#f8fafc] text-xs font-bold flex items-center justify-center gap-1 cursor-pointer transition group">
                    <i class="fas fa-image text-lg text-[#6366f1] group-hover:scale-110 transition-transform"></i> ุตูุฑุฉ
                    <input type="file" onchange="addRegularImage(this)" class="hidden" accept="image/*">
                </label>
                <button onclick="createNewProject()" class="bg-white border border-[#cbd5e1] py-2 rounded-lg text-[#1e293b] text-[10px] font-bold hover:bg-[#f8fafc] hover:border-[#6366f1] flex flex-col items-center gap-1 group"><i class="fas fa-file-circle-plus text-[#6366f1] group-hover:scale-110 transition-transform"></i> ุฌุฏูุฏ</button>
                
                <!-- ุฒุฑ ุงูุฅุทุงุฑุงุช ูุน Dropdown -->
                <div class="relative" onclick="event.stopPropagation();">
                    <button onclick="toggleFrameDropdown()" class="w-full bg-white border border-[#cbd5e1] py-2 rounded-lg text-[#1e293b] text-[10px] font-bold hover:bg-[#f8fafc] hover:border-[#6366f1] flex flex-col items-center gap-1 group min-w-[50px]">
                        <i class="far fa-square text-[#6366f1] group-hover:scale-110 transition-transform"></i> ุฅุทุงุฑ
                    </button>
                    
                    <!-- Dropdown Menu -->
                    <div id="frames-dropdown" class="hidden absolute top-full left-0 mt-2 bg-white border border-[#cbd5e1] rounded-lg shadow-lg z-50 p-1 w-[110px]">
                        <button onclick="addFrameType('square')" class="w-full px-2 py-1.5 text-left text-[10px] font-bold text-[#1e293b] hover:bg-[#f0f4ff] hover:text-[#6366f1] rounded transition flex items-center gap-2 mb-1">
                            <i class="far fa-square text-sm"></i> ูุฑุจุน
                        </button>
                        <button onclick="addFrameType('rounded')" class="w-full px-2 py-1.5 text-left text-[10px] font-bold text-[#1e293b] hover:bg-[#f0f4ff] hover:text-[#6366f1] rounded transition flex items-center gap-2 mb-1">
                            <i class="far fa-square text-sm" style="border-radius: 6px;"></i> ููุญูู
                        </button>
                        <button onclick="addFrameType('circle')" class="w-full px-2 py-1.5 text-left text-[10px] font-bold text-[#1e293b] hover:bg-[#f0f4ff] hover:text-[#6366f1] rounded transition flex items-center gap-2">
                             <i class="far fa-circle text-sm"></i> ุฏุงุฆุฑุฉ
                        </button>
                    </div>
                </div>
                
                <!-- ุฒุฑ ุงูุฃุดูุงู ูุน Dropdown -->
                <div class="relative" onclick="event.stopPropagation();">
                    <button onclick="addShape()" class="w-full bg-white border border-[#cbd5e1] py-2 rounded-lg text-[#1e293b] text-[10px] font-bold hover:bg-[#f8fafc] hover:border-[#6366f1] flex flex-col items-center gap-1 group"><i class="fas fa-square-full text-[#6366f1] group-hover:scale-110 transition-transform"></i> ุดูู</button>
                    
                    <!-- Dropdown Menu -->
                    <div id="shapes-dropdown" class="hidden absolute top-full left-0 right-0 mt-2 bg-white border border-[#cbd5e1] rounded-lg shadow-lg z-40 p-2">
                        <button onclick="addShapeType('square')" class="w-full px-3 py-2 text-left text-[11px] font-bold text-[#1e293b] hover:bg-[#f0f4ff] hover:border-l-4 hover:border-l-[#6366f1] rounded transition flex items-center gap-2">
                            <div class="w-4 h-4 bg-[#6366f1] rounded" style="border-radius: 2px;"></div> ูุฑุจุน
                        </button>
                        <button onclick="addShapeType('circle')" class="w-full px-3 py-2 text-left text-[11px] font-bold text-[#1e293b] hover:bg-[#f0f4ff] hover:border-l-4 hover:border-l-[#6366f1] rounded transition flex items-center gap-2">
                            <div class="w-4 h-4 bg-[#6366f1] rounded-full"></div> ุฏุงุฆุฑุฉ
                        </button>
                        <button onclick="addShapeType('line')" class="w-full px-3 py-2 text-left text-[11px] font-bold text-[#1e293b] hover:bg-[#f0f4ff] hover:border-l-4 hover:border-l-[#6366f1] rounded transition flex items-center gap-2">
                            <div class="w-4 h-0.5 bg-[#6366f1]"></div> ุฎุท
                        </button>
                        <button onclick="addShapeType('rounded')" class="w-full px-3 py-2 text-left text-[11px] font-bold text-[#1e293b] hover:bg-[#f0f4ff] hover:border-l-4 hover:border-l-[#6366f1] rounded transition flex items-center gap-2">
                            <div class="w-4 h-4 bg-[#6366f1] rounded-lg" style="border-radius: 4px;"></div> ููุญูู
                        </button>
                    </div>
                </div>
                
                <label class="bg-white border border-[#cbd5e1] py-2 rounded-lg text-[#1e293b] text-[10px] font-bold hover:bg-[#f8fafc] hover:border-[#6366f1] flex flex-col items-center gap-1 cursor-pointer group transition">
                    <i class="fas fa-folder-open text-[#6366f1] group-hover:scale-110 transition-transform"></i> ูุชุญ ููู
                    <input type="file" onchange="handleUniversalFile(this)" class="hidden" accept=".template,.json,.pdf,.tif,.tiff,.psd,.png,.jpg,.jpeg,.webp,.gif">
                </label>
            </div>

            <!-- ููุงุณุงุช ุงูุนูู (ูุฏูู ููุท - 10x10 ุงูุชุฑุงุถู) -->
            <div id="dimensions-container" class="bg-[#f8fafc] p-3 rounded-xl border border-[#e2e8f0]">
                <label class="text-xs font-bold text-[#1e293b] mb-2 block flex items-center gap-2">
                    <i class="fas fa-ruler-combined text-[#6366f1]"></i> ุฃุจุนุงุฏ ุงูุชุตููู (ุณู)
                </label>
                
                <div class="grid grid-cols-2 gap-2 mb-2">
                    <div class="relative">
                        <label class="text-[9px] text-[#64748b] font-bold block mb-1">ุงูุนุฑุถ (Width)</label>
                        <input type="text" inputmode="decimal" id="custom-width" value="6" class="w-full pl-8 px-2 py-1.5 border border-[#cbd5e1] rounded-lg text-sm outline-none focus:border-[#6366f1] text-center font-bold text-[#1e293b]" onfocus="this.select()" oninput="this.value = arabicToEnglish(this.value); applyCustomSizeSimple()">
                        <span class="absolute left-2 top-[26px] text-[12px] font-bold text-black">ุณู</span>
                    </div>
                    <div class="relative">
                        <label class="text-[9px] text-[#64748b] font-bold block mb-1">ุงูุงุฑุชูุงุน (Height)</label>
                        <input type="text" inputmode="decimal" id="custom-height" value="6" class="w-full pl-8 px-2 py-1.5 border border-[#cbd5e1] rounded-lg text-sm outline-none focus:border-[#6366f1] text-center font-bold text-[#1e293b]" onfocus="this.select()" oninput="this.value = arabicToEnglish(this.value); applyCustomSizeSimple()">
                        <span class="absolute left-2 top-[26px] text-[12px] font-bold text-black">ุณู</span>
                    </div>
                </div>
                
                <div class="mt-2 text-center">
                    <span id="size-display" class="text-[10px] font-bold text-[#64748b] bg-white px-2 py-1 rounded border border-[#e2e8f0]">1181 ร 1181 px</span>
                </div>
                
                <!-- ุงูุชุญูู ุจู Zoom -->
                <div id="zoom-container" class="mt-4 bg-gradient-to-b from-[#f0f9ff] to-[#e0f2fe] p-3 rounded-lg border border-[#7dd3fc]">
                    <div class="flex justify-between items-center mb-2">
                        <label class="text-[9px] text-[#0c4a6e] font-bold">๐ ูุณุชูู ุงูุฒูู</label>
                        <span id="zoom-display" class="text-[10px] font-bold text-[#0c4a6e] bg-white px-2 py-0.5 rounded">100%</span>
                    </div>
                    <input type="range" id="zoom-slider" min="25" max="200" value="100" class="w-full cursor-pointer" oninput="setCustomZoom(this.value)">
                    <div class="flex gap-1 mt-2">
                        <button onclick="setCustomZoom(50)" class="flex-1 bg-white border border-[#7dd3fc] text-[#0c4a6e] text-[9px] font-bold py-1 rounded hover:bg-[#e0f2fe]">50%</button>
                        <button onclick="setCustomZoom(75)" class="flex-1 bg-white border border-[#7dd3fc] text-[#0c4a6e] text-[9px] font-bold py-1 rounded hover:bg-[#e0f2fe]">75%</button>
                        <button onclick="setCustomZoom(100)" class="flex-1 bg-white border border-[#7dd3fc] text-[#0c4a6e] text-[9px] font-bold py-1 rounded hover:bg-[#e0f2fe]">100%</button>
                        <button onclick="setCustomZoom(150)" class="flex-1 bg-white border border-[#7dd3fc] text-[#0c4a6e] text-[9px] font-bold py-1 rounded hover:bg-[#e0f2fe]">150%</button>
                    </div>
                </div>
            </div>

            <!-- ูุณู ููุชุจุฉ ุงูุนูุงุตุฑ ุงูุฑุณููุฉ -->
            <div id="assets-library-container" class="bg-[#f8fafc] p-3 rounded-xl border border-[#e2e8f0]">
                <div class="flex justify-between items-center cursor-pointer" onclick="toggleAssetsLibrary()">
                    <label class="text-xs font-bold text-[#1e293b] flex items-center gap-2 cursor-pointer">
                        <i class="fas fa-shapes text-[#6366f1]"></i> ููุชุจุฉ ุงูุนูุงุตุฑ <span class="text-[#cbd5e1] mx-1">|</span> <span class="text-xs font-bold text-[#1e293b] flex items-center gap-1">ููุชุจุฉ ูุชุฌุฏุฏุฉ</span>
                    </label>
                    <i id="assets-library-arrow" class="fas fa-chevron-left text-[#64748b] text-xs transition-transform duration-200" style="transform: rotate(-90deg);"></i>
                </div>
                
                <div id="assets-library-content" class="mt-3 flex flex-col gap-2">
                    <!-- ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ููุชุตูููุงุช -->
                    <div class="w-full">
                        <select id="assets-category-select" class="w-full p-2 text-xs font-bold bg-white border border-[#cbd5e1] rounded-lg text-[#1e293b] outline-none focus:border-[#6366f1]" onchange="loadAssetsCategory()">
                            <option value="">๐ ุงุฎุชุฑ ุชุตูููุงู...</option>
                        </select>
                    </div>
                    
                    <!-- ุดุจูุฉ ุงูุนูุงุตุฑ -->
                    <div id="assets-grid" class="grid grid-cols-3 gap-2 max-h-[200px] overflow-y-auto p-1 bg-white rounded-lg border border-[#e2e8f0]">
                        <div class="col-span-3 text-center text-[10px] text-[#64748b] py-4">ุงุฎุชุฑ ุชุตูููุงู ูุนุฑุถ ุงูุนูุงุตุฑ</div>
                    </div>
                </div>
            </div>

            <!-- ูุณู ุงูุฎุตุงุฆุต ูุงูุญูุธ -->
            <div id="style-panel" class="bg-white p-4 rounded-2xl shadow-lg border border-[#cbd5e1] transition-all" onclick="event.stopPropagation()">
                <div class="flex justify-between items-center mb-4 border-b border-[#e2e8f0] pb-2 flex-wrap gap-2">
                    <span class="text-xs font-black text-[#6366f1] uppercase tracking-wider" id="panel-title">ุงูุชุตุฏูุฑ</span>
                    <!-- ุฃุฒุฑุงุฑ ุงูุญูุธ -->
                    <div class="flex gap-2 flex-wrap">
                        <button onclick="saveWorkDirectly()" class="bg-[#6366f1] text-white px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-[#4f46e5] flex items-center gap-1 shadow-md transition">
                            <i class="fas fa-image"></i> ุญูุธ ุตูุฑุฉ
                        </button>
                        <button onclick="openSaveAsModal()" class="bg-[#6366f1] text-white px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-[#4f46e5] flex items-center gap-1 shadow-md transition">
                            <i class="fas fa-download"></i> ุญูุธ ูููู
                        </button>
                        <button onclick="generateA4Sheet()" class="bg-[#ec4899] text-white px-3 py-1.5 rounded-lg text-[10px] font-bold hover:bg-[#db2777] flex items-center gap-1 shadow-md transition">
                            <i class="fas fa-print"></i> ุทุจุงุนุฉ A4
                        </button>
                    </div>
                </div>

                <div id="no-selection-msg" class="text-center py-4 text-[#64748b] text-xs font-bold opacity-70">
                    ุชุตุฏูุฑ ุงูุนูู ุงูููุงุฆู
                </div>

                <div id="text-controls" class="hidden space-y-4">
                    <input type="hidden" id="font-size">
                    <input type="hidden" id="font-size-input">
                    <input type="hidden" id="font-family">
                </div>

                <div id="frame-controls" class="hidden space-y-4">
                </div>
            </div>
        </div>

        <!-- ููุทูุฉ ุงูุนูู -->
        <div class="lg:col-span-8 flex flex-col gap-1">
            
            <!-- ุดุฑูุท ุงูุฃุฏูุงุช ุงูุนููู -->
            <div class="flex flex-wrap items-center bg-white p-2 rounded-xl border border-[#cbd5e1] shadow-sm justify-between gap-y-2" onclick="event.stopPropagation()">
                
                <!-- ูุฌููุนุฉ ุงูุฃุฏูุงุช ุงูุฃุณุงุณูุฉ -->
                <div class="flex items-center gap-1 md:gap-2">
                    <button onclick="undoAction()" class="p-1.5 md:p-2 text-[#64748b] hover:text-[#6366f1]"><i class="fas fa-undo"></i></button>
                    <button onclick="redoAction()" class="p-1.5 md:p-2 text-[#64748b] hover:text-[#6366f1]"><i class="fas fa-redo"></i></button>
                    <div class="w-px h-5 bg-[#e2e8f0] mx-1"></div>
                    
                    <!-- ุฃุฏูุงุช ุงูุฎูููุฉ ุงูุฌุฏูุฏุฉ -->
                    <div id="bg-tools-container" class="flex items-center gap-2 px-2 py-1 bg-[#f8fafc] rounded-lg border border-[#e2e8f0]">
                        <label class="text-[10px] md:text-xs font-bold text-[#1e293b] cursor-pointer flex items-center gap-2 hover:text-[#6366f1] transition group">
                            <i class="fas fa-fill-drip group-hover:scale-110 transition-transform"></i> ููู ุงูุฎูููุฉ
                            <!-- Improved Color Circle: Div shows color, input is invisible overlay -->
                            <div id="bg-color-preview" class="relative w-6 h-6 rounded-full border border-slate-300 shadow-sm transition-transform hover:scale-110" style="background-color: #ffffff;">
                                <input type="color" id="main-bg-color" oninput="setCardBackgroundColor(this.value)" value="#ffffff" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer">
                            </div>
                        </label>
                        <div class="w-px h-4 bg-[#cbd5e1]"></div>
                        <!-- ุฒุฑ ุงูุดูุงููุฉ -->
                        <button onclick="toggleTransparentMode()" id="btn-transparent" class="px-3 py-1.5 rounded text-[10px] md:text-xs font-bold bg-[#f8fafc] text-[#1e293b] hover:bg-[#6366f1] hover:text-white transition flex items-center gap-1.5 border border-[#e2e8f0]" title="ุชูุนูู/ุฅูุบุงุก ุงูุดูุงููุฉ">
                            <i class="fas fa-chess-board"></i> ุจูุง ุฎูููุฉ
                        </button>
                    </div>
                </div>

                <!-- ูุฌููุนุฉ ุฃุฏูุงุช ุงูุชุนุฏูู -->
                <div class="flex items-center gap-1 md:gap-2">
                      <button onclick="toggleGradient()" id="btn-grad" class="px-2 py-1.5 rounded text-[10px] md:text-xs font-bold bg-[#f8fafc] text-[#1e293b] hover:bg-[#6366f1] hover:text-white transition flex items-center gap-1 border border-[#e2e8f0]">
                        <i class="fas fa-adjust"></i> ุงูุชุฏุฑุฌ
                    </button>
                    <!-- ุชุนุฏูู ุฒุฑ ุงูููุญุงุฉ ุญุณุจ ุงูุทูุจ ูุฅุธูุงุฑ ุงููุต ุฏุงุฆูุงู -->
                    <button onclick="toggleEraserMode()" id="btn-eraser" class="px-2 py-1.5 rounded text-[10px] md:text-xs font-bold bg-[#f8fafc] text-[#1e293b] hover:bg-[#6366f1] hover:text-white transition flex items-center gap-1 border border-[#e2e8f0]">
                        <i class="fas fa-eraser"></i> <span class="ml-1 text-[9px] font-black">ุงูููุญุงุฉ</span>
                    </button>
                    <!-- ุฒุฑ ุงููุต ุงูุฐูู (Lasso) ุงูุฌุฏูุฏ -->
                    <button onclick="toggleLassoMode()" id="btn-lasso" class="px-2 py-1.5 rounded text-[10px] md:text-xs font-bold bg-[#f8fafc] text-[#1e293b] hover:bg-[#6366f1] hover:text-white transition flex items-center gap-1 border border-[#e2e8f0]">
                        <i class="fas fa-cut"></i> <span class="ml-1 text-[9px] font-black">ูุต ุฐูู</span>
                    </button>
                    <!-- ุฒุฑ ุงููุต (Crop) ุงูุฌุฏูุฏ -->
                    <button onclick="toggleCropMode()" id="btn-crop" class="px-2 py-1.5 rounded text-[10px] md:text-xs font-bold bg-[#f8fafc] text-[#1e293b] hover:bg-[#6366f1] hover:text-white transition flex items-center gap-1 border border-[#e2e8f0]">
                        <i class="fas fa-crop"></i> <span class="ml-1 text-[9px] font-black">ูุต</span>
                    </button>
                    <!-- ุฒุฑ ุงููุฏ (Hand Tool) ููุชุญุฑูู -->
                    <button onclick="toggleHandMode()" id="btn-hand" class="w-8 h-8 rounded-lg text-lg bg-[#f8fafc] text-[#1e293b] hover:bg-[#6366f1] hover:text-white transition flex items-center justify-center border border-[#e2e8f0] shadow-sm hover:shadow-md" title="ุฃุฏุงุฉ ุงููุฏ - ุชุญุฑูู ููุทูุฉ ุงูุนูู">
                        <i class="fa-regular fa-hand"></i>
                    </button>
                    <!-- Universal File Input: Supports All Formats -->
                    <input type="file" onchange="handleUniversalFile(this)" class="hidden" accept=".tif,.tiff,.pdf,.psd,.ai,.eps,.svg,.png,.jpg,.jpeg,.webp,.bmp">
                </div>
                
                <!-- ููุญุงุช ุงูุชุญูู -->
                

                <!-- ุงูุฃููุงู ุงูููุถูุฉ -->
                <div id="fav-colors-row" class="bg-[#f8fafc] px-2 py-1.5 rounded-lg border border-[#e2e8f0] flex items-center gap-2 overflow-x-auto mb-2">
                    <span class="text-[9px] font-bold text-[#1e293b] whitespace-nowrap">ููุถูุฉ:</span>
                    <div id="fav-colors-container" class="flex items-center gap-1.5 flex-wrap">
                        <!-- ุณูุชู ุชุนุจุฆุชูุง ุจูุงุณุทุฉ JS -->
                    </div>
                    <div class="w-px h-4 bg-[#e2e8f0] mx-1"></div>
                    <div class="relative" title="ุฅุถุงูุฉ ููู ุฌุฏูุฏ">
                        <label for="add-fav-color" class="w-5 h-5 rounded-full bg-white border border-dashed border-gray-400 flex items-center justify-center cursor-pointer hover:border-[#6366f1] text-gray-400 hover:text-[#6366f1] transition shadow-sm">
                            <i class="fas fa-plus text-[8px]"></i>
                        </label>
                        <input type="color" id="add-fav-color" class="absolute opacity-0 w-0 h-0" onchange="addFavoriteColor(this.value)">
                    </div>

                    <!-- ุฎุตุงุฆุต ุงูุนูุตุฑ ุงููุญุฏุฏ (ุดูุงููุฉ ุงูุตูุฑุฉ) -->
                    <div id="quick-props" class="hidden flex items-center gap-1 border-r border-[#e2e8f0] pr-2 mr-2">
                        <span class="text-[9px] text-[#1e293b] font-bold whitespace-nowrap">ุดูุงููุฉ:</span>
                        <input type="range" id="layer-opacity" min="0" max="100" value="100" oninput="updateLayerOpacity(this.value)" class="w-16 h-1.5 bg-[#e2e8f0] rounded-lg accent-[#6366f1] cursor-pointer">
                        <span id="opacity-value" class="text-[9px] font-bold text-[#6366f1] w-6">100%</span>
                        
                        <!-- ุนูุงุตุฑ ูุฎููุฉ ููุงุณุชุฎุฏุงู ุงูุฏุงุฎูู -->
                        <span id="text-color-section" class="hidden">
                             <input type="color" id="quick-color" oninput="updateStyle('color', this.value)">
                        </span>
                    </div>

                    <!-- ุฅุนุฏุงุฏุงุช ุงูุฅุทุงุฑ (ุชู ููููุง ููุง) -->
                    <div id="frame-controls-toolbar" class="hidden flex items-center gap-1 border-r border-[#e2e8f0] pr-2 mr-2">
                        <span class="text-[9px] font-bold text-[#1e293b]">ููู ุงูุญุฏ:</span>
                        <input type="color" id="border-color" oninput="updateStyle('borderColor', this.value)" class="w-5 h-5 rounded cursor-pointer border border-[#cbd5e1]">
                        <div class="w-px h-4 bg-[#cbd5e1] mx-1"></div>
                        <span class="text-[9px] font-bold text-[#1e293b]">ุณูู:</span>
                        <input type="range" id="border-width" min="0" max="20" value="1" oninput="updateStyle('borderWidth', this.value + 'px')" class="w-16 h-1.5 bg-[#e2e8f0] rounded-lg accent-[#6366f1]">
                        <div class="w-px h-4 bg-[#cbd5e1] mx-1"></div>
                        <span class="text-[9px] font-bold text-[#1e293b]">ููู:</span>
                        <input type="color" id="bg-color" oninput="updateStyle('backgroundColor', this.value)" class="w-5 h-5 rounded cursor-pointer border border-[#cbd5e1]">
                    </div>
                </div>

                <!-- ุฅุนุฏุงุฏุงุช ุงูุชุฏุฑุฌ -->
                <div id="grad-controls" class="controls-row bg-[#f8fafc] px-2 py-1.5 rounded-lg border border-[#e2e8f0]">
                    <!-- Global Overlay Controls -->
                    <div id="global-grad-inputs" class="flex items-center gap-2">
                        <span class="text-[9px] font-bold text-[#1e293b]">ุชุฏุฑุฌ:</span>
                        <input type="color" id="global-grad-start" value="#000000" oninput="updateGlobalGradient()" class="w-5 h-5 rounded cursor-pointer border-none bg-transparent" title="ุจุฏุงูุฉ ุงูุชุฏุฑุฌ (ุฃุณูู)">
                        <input type="color" id="global-grad-end" value="#ffffff" oninput="updateGlobalGradient()" class="w-5 h-5 rounded cursor-pointer border-none bg-transparent" title="ููุงูุฉ ุงูุชุฏุฑุฌ (ุฃุนูู)">
                        
                        <div class="w-px h-4 bg-[#6366f1] mx-1"></div>
                        <input type="range" min="0" max="1" step="0.1" value="0.8" oninput="updateGlobalGradient()" id="global-grad-opacity" class="w-16 h-1.5 accent-[#6366f1] cursor-pointer" title="ุงูุดูุงููุฉ">
                        <div class="w-px h-4 bg-[#6366f1] mx-1"></div>
                        <span class="text-[9px] font-bold text-[#1e293b]">ุงูุชูุฏุฏ:</span>
                        <input type="range" min="10" max="100" value="50" oninput="updateGlobalGradient()" id="global-grad-height" class="w-16 h-1.5 accent-[#6366f1] cursor-pointer" title="ุงุฑุชูุงุน ุงูุชุฏุฑุฌ">
                    </div>

                    <!-- Element Gradient Controls -->
                    <div id="element-grad-inputs" class="hidden items-center gap-2">
                        <span class="text-[9px] font-bold text-[#1e293b]">ุงูุจุฏุงูุฉ:</span>
                        <input type="color" id="grad-start-color" value="#6366f1" oninput="syncFloatGradientInputs('start', this.value); updateElementGradient()" class="w-5 h-5 rounded cursor-pointer border-none bg-transparent">
                        
                        <span class="text-[9px] font-bold text-[#1e293b]">ุงูููุงูุฉ:</span>
                        <input type="color" id="grad-end-color" value="#ec4899" oninput="syncFloatGradientInputs('end', this.value); updateElementGradient()" class="w-5 h-5 rounded cursor-pointer border-none bg-transparent">
                        
                        <div class="w-px h-4 bg-[#6366f1] mx-1"></div>
                        
                        <span class="text-[9px] font-bold text-[#1e293b]">ุงูุฒุงููุฉ:</span>
                        <input type="range" min="0" max="360" value="90" id="grad-angle" oninput="syncFloatGradientInputs('angle', this.value); updateElementGradient()" class="w-16 h-1.5 accent-[#6366f1] cursor-pointer" title="ุฒุงููุฉ ุงูุชุฏุฑุฌ">

                        <div class="w-px h-4 bg-[#6366f1] mx-1"></div>

                        <span class="text-[9px] font-bold text-[#1e293b]">ุงูุดูุงููุฉ:</span>
                        <input type="range" min="0" max="1" step="0.1" value="1" id="grad-opacity" oninput="updateElementGradient()" class="w-16 h-1.5 accent-[#6366f1] cursor-pointer" title="ุดูุงููุฉ ุงูุชุฏุฑุฌ">
                        
                        <div class="w-px h-4 bg-[#6366f1] mx-1"></div>
                        <button onclick="toggleGradient()" class="px-2 py-0.5 bg-red-500 text-white rounded text-[9px] font-bold hover:bg-red-600 transition" title="ุฅุฒุงูุฉ ุงูุชุฏุฑุฌ">
                            <i class="fas fa-times"></i> ุฅูุบุงุก
                        </button>
                    </div>
                </div>

                <!-- ุชู ููู ุฃุฏูุงุช ุงูุชุญูู ุจุงููุตูุต ูุงูุฃุทุฑ ุฅูู ูุงูุฐุฉ ุนุงุฆูุฉ -->


                <!-- ุฅุนุฏุงุฏุงุช ุงูููุญุงุฉ -->
                <div id="eraser-controls" class="controls-row bg-[#f8fafc] px-2 py-1.5 rounded-lg border border-[#e2e8f0]">
                    <div class="flex items-center gap-1 pl-2">
                        <label class="flex items-center gap-1 cursor-pointer">
                            <input type="checkbox" id="eraser-protect-bg" checked class="w-3 h-3 accent-[#6366f1]">
                            <span class="text-[9px] font-bold text-[#1e293b]">ุญูุงูุฉ ุงูุฎูููุฉ</span>
                        </label>
                    </div>
                    
                    <div class="flex items-center gap-1">
                         <span class="text-[9px] font-bold text-[#1e293b]">ุญุฌู:</span>
                         <input type="range" min="5" max="100" value="30" id="eraser-size" class="w-12 h-1 accent-[#6366f1] cursor-pointer">
                         <span id="eraser-size-display" class="text-[9px] font-bold w-4">30</span>
                    </div>

                    <div class="flex items-center gap-1">
                        <span class="text-[9px] font-bold text-[#1e293b]">ูุนููุฉ:</span>
                        <input type="range" min="0" max="50" value="0" id="eraser-softness" class="w-12 h-1 accent-[#6366f1] cursor-pointer">
                        <span id="eraser-softness-display" class="text-[9px] font-bold w-4">0</span>
                    </div>
                    
                    <div class="w-px h-4 bg-[#6366f1] mx-1"></div>
                    <!-- ุชุนุฏูู ุฒุฑ ุงูููุญุงุฉ ุงูุณุญุฑูุฉ ูุฅุธูุงุฑ ุงููุต -->
                    <button id="btn-magic" onclick="toggleMagicMode()" class="px-2 py-0.5 rounded text-[9px] font-bold bg-white border border-[#cbd5e1] text-[#1e293b] hover:bg-[#6366f1] hover:text-white transition flex items-center gap-1" title="ููุญุงุฉ ุณุญุฑูุฉ">
                        <i class="fas fa-magic"></i> <span class="ml-1 text-[9px] font-black">ุงูููุญุงุฉ ุงูุณุญุฑูุฉ</span>
                    </button>
                    
                    <div id="magic-tolerance-control" class="hidden items-center gap-1">
                         <span class="text-[9px] font-bold text-[#6366f1]">ุฏูุฉ:</span>
                         <input type="range" min="1" max="100" value="30" id="magic-tolerance" class="w-10 h-1 accent-[#6366f1] cursor-pointer">
                         <span id="magic-tolerance-display" class="text-[9px] font-bold w-4">30</span>
                    </div>

                    <div class="w-px h-4 bg-[#6366f1] mx-1"></div>
                    <button onclick="exitEraserMode()" class="px-2 py-0.5 rounded text-[9px] font-bold bg-slate-300 text-slate-700 hover:bg-slate-400 transition">ุฅููุงุก</button>
                </div>
            </div>

            <!-- ุดุฑูุท ุงูููุงุญุธุงุช ุงูุฌุฏูุฏ (ูุงุจู ูููุชุญ) -->
            <div id="info-bar-placeholder" class="bg-[#f1f5f9] p-3 rounded text-[11px] text-[#1e293b] border border-[#e2e8f0] flex items-center gap-2 font-bold cursor-pointer hover:bg-[#e8f0fe] transition" onclick="openDesignerPanel()">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-notebook" style="flex-shrink: 0;"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 4h11a2 2 0 0 1 2 2v12a2 2 0 0 1 -2 2h-11a1 1 0 0 1 -1 -1v-14a1 1 0 0 1 1 -1m3 0v18" /><path d="M13 8l2 0" /><path d="M13 12l2 0" /></svg> <span>ุงุถุบุท ููุง ููุชุงุจุฉ ููุงุญุธุงุชู - write your notes</span>
            </div>

            <!-- ูุงูุฐุฉ ููุญุฉ ุงููุตูู (Collapsible Designer Panel) -->
            <div id="designer-panel" class="hidden fixed inset-0 bg-black/40 z-40 flex items-center justify-center" onclick="if(event.target.id === 'designer-panel') closeDesignerPanel()">
                <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full mx-4 max-h-[70vh] overflow-y-auto" onclick="event.stopPropagation()">
                    <!-- ุฑุฃุณ ุงููุงูุฐุฉ -->
                    <div class="sticky top-0 bg-gradient-to-r from-[#6366f1] to-[#4f46e5] text-white p-4 rounded-t-2xl flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <i class="fas fa-palette text-xl"></i>
                            <h2 class="text-lg font-bold">ููุญุฉ ุงููุตูู</h2>
                        </div>
                        <button onclick="closeDesignerPanel()" class="bg-white/20 hover:bg-white/30 p-2 rounded-lg transition">
                            <i class="fas fa-times text-lg"></i>
                        </button>
                    </div>

                    <!-- ูุญุชูู ุงููุงูุฐุฉ -->
                    <div class="p-4 space-y-3">
                        <!-- ููุงุญุธุงุช ุงููุตูู (ุฃูู ุดู) -->
                        <div class="bg-[#fef3c7] p-3 rounded-lg border-l-4 border-[#f59e0b]">
                            <h3 class="font-bold text-[#92400e] mb-2 flex items-center justify-between text-sm">
                                <span class="flex items-center gap-2">
                                    <i class="fas fa-sticky-note text-[#f59e0b]"></i> ููุงุญุธุงุช ุงูุชุตููู
                                </span>
                                <div class="flex flex-col items-end">
                                    <span class="text-xs bg-[#f59e0b] text-white px-2 py-0.5 rounded" id="char-count">0/280</span>
                                    <span class="text-[9px] text-[#92400e] mt-1 font-medium opactiy-80">ุงูุจุฑููููู: 1000</span>
                                </div>
                            </h3>
                            <textarea 
                                id="designer-notes" 
                                class="w-full h-20 p-2 bg-white/50 border-none rounded text-[#78350f] text-xs resize-none focus:outline-none focus:ring-0 placeholder:text-gray-500"
                                placeholder="ููุง ูุณุงุญุชู ุงูุฎุงุตุฉ.. ุฏููู ุฃููุงุฑูุ ุชุนูููุงุชู ุนูู ุงูุชุตูููุ ุฃู ุฃู ุชูุงุตูู ุฅุจุฏุงุนูุฉ ุชุฎุทุฑ ุจุจุงูู ูุชุฐูุฑูุง ูุงุญูุงู"
                                maxlength="280"
                                onchange="updateDesignerNotes()"
                                oninput="updateCharCount()"
                                style="background-image: 
                                    repeating-linear-gradient(
                                        to bottom,
                                        transparent,
                                        transparent 18px,
                                        #f59e0b20 18px,
                                        #f59e0b20 19px
                                    );
                                background-size: 100% 19px;
                                background-position: 0 8px;
                                padding-top: 10px;"
                            ></textarea>
                        </div>

                        <!-- ุฅุญุตุงุฆูุงุช ุงูุชุตููู ุงูุญุงูู (ูุตุบุฑุฉ) -->
                        <div class="bg-[#f8fafc] p-3 rounded-lg border border-[#e2e8f0]">
                            <h3 class="font-bold text-[#1e293b] mb-2 flex items-center gap-2 text-sm">
                                <i class="fas fa-chart-pie text-[#6366f1]"></i> ุงูุฅุญุตุงุฆูุงุช
                            </h3>
                            <div class="grid grid-cols-2 gap-3 text-xs">
                                <div>
                                    <span class="text-[#64748b]">ุงูุนูุงุตุฑ:</span>
                                    <p class="font-bold text-[#1e293b]" id="element-count">0</p>
                                </div>
                                <div>
                                    <span class="text-[#64748b]">ุงูููุงุณ:</span>
                                    <p class="font-bold text-[#1e293b]" id="canvas-size">-</p>
                                </div>
                            </div>
                            
                            <!-- ุงูุฃููุงู ุงููุณุชุฎุฏูุฉ -->
                            <div class="mt-3 pt-3 border-t border-[#e2e8f0]">
                                <span class="text-[#64748b] text-[10px] block mb-2 font-bold">ุงูุฃููุงู ุงููุณุชุฎุฏูุฉ:</span>
                                <div id="used-colors-palette" class="flex flex-wrap gap-1.5 min-h-[20px]">
                                    <!-- ุณูุชู ุฅุถุงูุฉ ุงูุฃููุงู ููุง ุจูุงุณุทุฉ JS -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ุชุฐููู ุงููุงูุฐุฉ -->
                    <div class="bg-[#f8fafc] p-3 rounded-b-2xl border-t border-[#e2e8f0]">
                        <button onclick="closeDesignerPanel()" class="w-full bg-[#6366f1] text-white px-4 py-2 rounded-lg font-bold hover:bg-[#4f46e5] transition text-sm">
                            ุฅุบูุงู
                        </button>
                    </div>
                </div>
            </div>

            <div class="preview-area" onclick="deselect(event)">
                <div id="card-wrapper">
                    <div id="ruler-h" class="ruler ruler-h"></div>
                    <div id="ruler-v" class="ruler ruler-v"></div>
                    <div id="card" onmousedown="deselectOnCard(event)" ontouchstart="deselectOnCard(event); event.preventDefault(); event.stopPropagation();" ontouchend="event.preventDefault(); event.stopPropagation();">
                        <div id="card-gradient"></div>
                    </div>
                    <!-- Crop Overlay -->
                    <div id="crop-overlay" class="hidden absolute top-0 left-0 w-full h-full pointer-events-auto z-[50000]" style="background: rgba(0, 0, 0, 0.5);">
                        <!-- Crop Area (draggable and resizable) -->
                        <div id="crop-area" class="absolute border-2 border-yellow-400" style="box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5), inset 0 0 0 1000px rgba(0, 0, 0, 0); cursor: move; background-color: transparent;">
                            <!-- Top-left corner handle -->
                            <div id="crop-handle-tl" class="absolute w-3 h-3 bg-yellow-400 border border-white cursor-nwse-resize" style="top: -6px; left: -6px;"></div>
                            <!-- Top-right corner handle -->
                            <div id="crop-handle-tr" class="absolute w-3 h-3 bg-yellow-400 border border-white cursor-nesw-resize" style="top: -6px; right: -6px;"></div>
                            <!-- Bottom-left corner handle -->
                            <div id="crop-handle-bl" class="absolute w-3 h-3 bg-yellow-400 border border-white cursor-nesw-resize" style="bottom: -6px; left: -6px;"></div>
                            <!-- Bottom-right corner handle -->
                            <div id="crop-handle-br" class="absolute w-3 h-3 bg-yellow-400 border border-white cursor-nwse-resize" style="bottom: -6px; right: -6px;"></div>
                            <!-- Top edge handle -->
                            <div id="crop-handle-t" class="absolute w-6 h-2 bg-yellow-400 border border-white cursor-ns-resize" style="top: -5px; left: 50%; transform: translateX(-50%);"></div>
                            <!-- Bottom edge handle -->
                            <div id="crop-handle-b" class="absolute w-6 h-2 bg-yellow-400 border border-white cursor-ns-resize" style="bottom: -5px; left: 50%; transform: translateX(-50%);"></div>
                            <!-- Left edge handle -->
                            <div id="crop-handle-l" class="absolute w-2 h-6 bg-yellow-400 border border-white cursor-ew-resize" style="left: -5px; top: 50%; transform: translateY(-50%);"></div>
                            <!-- Right edge handle -->
                            <div id="crop-handle-r" class="absolute w-2 h-6 bg-yellow-400 border border-white cursor-ew-resize" style="right: -5px; top: 50%; transform: translateY(-50%);"></div>
                        </div>
                        <!-- Crop Buttons -->
                        <div class="absolute bottom-6 left-1/2 transform -translate-x-1/2 flex gap-2 z-[50001]">
                            <button onclick="applyCrop()" class="px-4 py-2 bg-green-500 text-white rounded font-bold text-sm hover:bg-green-600 transition">โ ุชุทุจูู</button>
                            <button onclick="exitCropMode()" class="px-4 py-2 bg-red-500 text-white rounded font-bold text-sm hover:bg-red-600 transition">โ ุฅูุบุงุก</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ูุง ููุฌุฏ ููุชุฑ -->

    <!-- ูุงูุฐุฉ ุฃุฏูุงุช ุนุงุฆูุฉ (ุจุฏููุฉ ุนู ุงูุดุฑูุท ุงูุนููู ูููุน ุฅุฒุงุญุฉ ุงูุชุตููู) -->
    <div id="floating-context-toolbar" class="hidden fixed top-[18%] left-1/2 transform -translate-x-1/2 z-[99999] bg-white/95 backdrop-blur shadow-2xl rounded-2xl border border-indigo-100 p-2 flex flex-col gap-2 transition-all duration-300 pointer-events-auto min-w-[280px] max-h-[80vh] overflow-y-auto" style="box-shadow: 0 4px 16px -4px rgba(0,0,0,0.10);">
        
        <!-- Header with Close Button (Draggable Handle) -->
        <div id="floating-toolbar-header" class="flex justify-between items-center px-1 mb-1 border-b border-gray-100 pb-1 cursor-move select-none sticky top-0 bg-white/95" title="ุงุถุบุท ูุงุณุญุจ ููุชุญุฑูู">
            <span class="text-[10px] text-gray-400 font-bold pointer-events-none">ุฎุตุงุฆุต ุงูุนูุตุฑ</span>
            <button onclick="closeFloatingToolbar()" class="text-red-500 hover:text-red-700 w-5 h-5 flex items-center justify-center rounded-full hover:bg-red-50 transition" title="ุฅุบูุงู">
                <i class="fas fa-times text-[12px]"></i>
            </button>
        </div>

        <!-- ุงูุตู ุงูุฃูู: ุฒุฑ ุงูุชุฏุฑุฌ + ููู ุงููุต + ุญุฌู ุงูุฎุท -->
        <div id="gradient-toggle-row" class="hidden controls-row px-2 py-1 rounded items-center gap-2 justify-start flex-wrap">
            <button id="btn-toggle-gradient" onclick="toggleGradientMode()" class="px-2 py-1 rounded text-[9px] font-bold bg-[#f8fafc] text-[#334155] hover:bg-[#6366f1] hover:text-white transition flex items-center gap-1 border border-[#e2e8f0] shadow-sm">
                <i class="fas fa-fill-drip text-[8px]"></i> ุชุฏุฑุฌ
            </button>
            <div class="w-px h-4 bg-[#e2e8f0]"></div>
            
            <!-- Partial Color Hint Tooltip Wrapper -->
            <div class="relative group flex items-center gap-1">
                <span class="text-[9px] font-bold text-[#1e293b] whitespace-nowrap">ููู ุงููุต:</span>
                <input type="color" id="top-text-color" value="#1e293b" onchange="applyTextColor(this.value)" oninput="applyTextColor(this.value)" class="w-6 h-6 rounded cursor-pointer border border-[#cbd5e1] bg-transparent" title="ููู ุงููุต (ุญุฏุฏ ุฌุฒุก ูุชููููู)">
                <!-- Tooltip -->
                <span class="opacity-0 group-hover:opacity-100 transition-opacity absolute -top-8 left-1/2 transform -translate-x-1/2 bg-black text-white text-[8px] px-2 py-1 rounded pointer-events-none whitespace-nowrap z-50">ุธูู ูุตุงู ูุชููููู ูููุฑุฏุงู</span>
            </div>

            <div class="w-px h-4 bg-[#e2e8f0]"></div>
            <span class="text-[9px] font-bold text-[#1e293b] whitespace-nowrap">ุงูุญุฌู:</span>
            <input type="range" id="top-font-size" min="10" max="150" value="35" oninput="updateStyle('fontSize', this.value + 'px'); document.getElementById('font-size-input').value = this.value; document.getElementById('top-font-size-input').value = this.value;" class="w-14 h-1.5 accent-[#6366f1]" title="ุญุฌู ุงูุฎุท">
            <input type="text" inputmode="numeric" id="top-font-size-input" value="35" oninput="this.value = arabicToEnglish(this.value); updateStyle('fontSize', this.value + 'px'); document.getElementById('font-size').value = this.value; document.getElementById('top-font-size').value = this.value;" class="w-10 px-1 py-0.5 border border-[#cbd5e1] rounded text-[10px] font-bold text-[#1e293b] text-center outline-none focus:border-[#6366f1]">
        </div>

        <!-- ุงูุตู ุงูุซุงูู: ููุน ุงูุฎุท + ูุงุฆูุฉ ุงูุฎุทูุท + ูุฌูุฉ ุงูููุถูุฉ + B + ุงููุญุงุฐุงุฉ -->
        <div id="top-font-controls" class="hidden controls-row px-2 py-1 rounded items-center gap-2 justify-start flex-wrap">
            <span class="text-[9px] font-bold text-[#1e293b] whitespace-nowrap">ููุน ุงูุฎุท:</span>
            <select id="top-font-family" onchange="handleFontSelection(this)" class="bg-white border border-[#cbd5e1] rounded text-[9px] py-0.5 px-1 font-bold outline-none focus:border-[#6366f1] text-[#1e293b] max-w-[130px]">
                <!-- ูุณู ุงูููุถูุฉ (ููููุฃ ุฏููุงููููุงู) -->
                <optgroup id="fav-fonts-group" label="โญ ุงูููุถูุฉ" style="display:none;"></optgroup>
                <!-- ุงูุฎุทูุท ุงูุฃุณุงุณูุฉ -->
                <optgroup label="ุงูุฎุทูุท ุงูุฃุณุงุณูุฉ">
                    <option value="'Cairo', sans-serif">ูุงูุฑู (Cairo) - ููุฏุฑู</option>
                    <option value="'Tajawal', sans-serif">ุชุฌูุงู (Tajawal) - ุงููููุฏุณ</option>
                    <option value="'Almarai', sans-serif">ุงููุฑุงุนู (Almarai) - ุฑุณูู</option>
                    <option value="'Zain', sans-serif">ุฒูู (Zain) - ุนุตุฑู</option>
                    <option value="'Mada', sans-serif">ูุฏู (Mada) - ูุงุนู</option>
                </optgroup>
                <!-- ุงูุฎุทูุท ุงูุนุตุฑูุฉ ุงูุฌุฏูุฏุฉ -->
                <optgroup label="ุฎุทูุท ุนุตุฑูุฉ">
                    <option value="'Rubik', sans-serif">ุฑูุจูู (Rubik) - ุชุทุจููุงุช</option>
                    <option value="'Readex Pro', sans-serif">ุฑูุฏูุณ (Readex Pro) - ูุงุถุญ</option>
                    <option value="'Alexandria', sans-serif">ุฅุณููุฏุฑูุฉ (Alexandria) - ุฃููู</option>
                    <option value="'Noto Sans Arabic', sans-serif">ููุชู ุณุงูุณ (Noto Sans) - ุญุฏูุซ</option>
                    <option value="'Noto Kufi Arabic', sans-serif">ููุชู ูููู (Noto Kufi) - ูููู ุญุฏูุซ</option>
                    <option value="'Akatab', sans-serif">ุฃูุชุจ (Akatab) - ุจุณูุท</option>
                    <option value="'Harmattan', sans-serif">ูุฑูุชุงู (Harmattan) - ูุงุนู</option>
                    <option value="'Mirza', sans-serif">ููุฑุฒุง (Mirza) - ููู</option>
                </optgroup>
                <!-- ุงูุฎุทูุท ุงููููุฉ ูุงูุฅุจุฏุงุนูุฉ -->
                <optgroup label="ุฎุทูุท ูููุฉ">
                    <option value="'Blaka', cursive">ุจูุงูุง (Blaka) - ุฅุจุฏุงุนู</option>
                    <option value="'Blaka Ink', cursive">ุจูุงูุง ุญุจุฑ (Blaka Ink) - ุญุจุฑู</option>
                    <option value="'Blaka Hollow', cursive">ุจูุงูุง ููุฑุบ (Blaka Hollow) - ููุฑุบ</option>
                    <option value="'Marhey', cursive">ูุฑุญู (Marhey) - ูุฏูู</option>
                    <option value="'Katibeh', serif">ูุงุชุจุฉ (Katibeh) - ูุฒุฎุฑู</option>
                    <option value="'Rakkas', serif">ุฑูุงุต (Rakkas) - ููู</option>
                    <option value="'Lalezar', cursive">ูุงููุฒุงุฑ (Lalezar) - ุนุฑูุถ</option>
                </optgroup>
                <!-- ุงูุฎุทูุท ุงูููุงุณูููุฉ -->
                <optgroup label="ุฎุทูุท ููุงุณูููุฉ">
                    <option value="'Noto Serif Arabic', serif">ููุชู ุณูุฑูู (Noto Serif) - ุณูุฑูู</option>
                    <option value="'Amiri', serif">ุฃููุฑู (Amiri) - ูุณุฎ</option>
                    <option value="'Aref Ruqaa', serif">ุนุงุฑู (Aref Ruqaa) - ุฑูุนุฉ</option>
                    <option value="'Scheherazade New', serif">ุดูุฑุฒุงุฏ (Scheherazade) - ุชุฑุงุซู</option>
                    <option value="'Lateef', serif">ูุทูู (Lateef) - ููุงุณููู</option>
                    <option value="'Gulzar', serif">ุฌูุฒุงุฑ (Gulzar) - ูุณุชุนููู</option>
                    <option value="'Markazi Text', serif">ูุฑูุฒู (Markazi) - ุนูุงููู</option>
                </optgroup>
                <!-- ุฎุทูุท ูุชููุนุฉ -->
                <optgroup label="ุฎุทูุท ูุชููุนุฉ">
                    <option value="'IBM Plex Sans Arabic', sans-serif">ุจููุณ (IBM Plex) - ุชููู</option>
                    <option value="'Vazirmatn', sans-serif">ูุฒูุฑ (Vazirmatn) - ูุธูู</option>
                    <option value="'Reem Kufi', sans-serif">ุฑูู (Reem Kufi) - ูููู</option>
                    <option value="'Kufam', sans-serif">ูููู (Kufam) - ูููู ูุทูุฑ</option>
                    <option value="'El Messiri', sans-serif">ุงููุณูุฑู (El Messiri) - ูููุฒ</option>
                    <option value="'Changa', sans-serif">ุดุงูุฌุง (Changa) - ููู</option>
                    <option value="'Baloo Bhaijaan 2', cursive">ุจุงูู (Baloo) - ุทูููู</option>
                    <option value="'Lemonada', cursive">ูููููุงุฏุฉ (Lemonada) - ุนููู</option>
                </optgroup>
                <!-- ุฅุถุงูุฉ ุฎุท ูุฎุตุต -->
                <optgroup label="โโโโโโโโโโโโโโ">
                    <option value="__ADD_CUSTOM_FONT__" style="color: #6366f1; font-weight: bold;">โ ุฅุถุงูุฉ ุฎุท ูุฎุตุต...</option>
                </optgroup>
            </select>
            <!-- ุฒุฑ ุงููุฌูุฉ ููููุถูุฉ -->
            <button id="btn-fav-font" onclick="toggleFavoriteFont()" class="px-1.5 py-0.5 rounded text-[18px] bg-transparent border-none text-[#cbd5e1] hover:text-[#f59e0b] transition" title="ุฅุถุงูุฉ/ุฅุฒุงูุฉ ูู ุงูููุถูุฉ">
                โ
            </button>
            <input type="file" id="custom-font-input" accept=".ttf,.otf,.woff,.woff2" style="display:none" onchange="handleCustomFontUpload(this)">
            <!-- ุฒุฑ ุงูุจููุฏ -->
            <button id="btn-bold" onclick="toggleBold()" class="px-2 py-0.5 rounded text-[10px] font-bold bg-white border border-[#cbd5e1] text-[#1e293b] hover:bg-[#6366f1] hover:text-white transition" title="ุฎุท ุนุฑูุถ">
                B
            </button>
            
            <!-- ุฃุฒุฑุงุฑ ุงููุญุงุฐุงุฉ (ุตุบูุฑุฉ ุฌุงูุจูุฉ) -->
            <div class="flex items-center gap-0.5 bg-white border border-[#cbd5e1] rounded px-1 py-0 overflow-hidden shadow-sm h-[24px]">
                <button onclick="updateStyle('textAlign', 'right')" class="w-6 h-full flex items-center justify-center text-[#64748b] hover:text-[#6366f1] hover:bg-slate-50 transition" title="ูููู">
                    <i class="fas fa-align-right text-[10px]"></i>
                </button>
                <div class="w-px h-3 bg-gray-200"></div>
                <button onclick="updateStyle('textAlign', 'center')" class="w-6 h-full flex items-center justify-center text-[#64748b] hover:text-[#6366f1] hover:bg-slate-50 transition" title="ูุณุท">
                    <i class="fas fa-align-center text-[10px]"></i>
                </button>
                <div class="w-px h-3 bg-gray-200"></div>
                <button onclick="updateStyle('textAlign', 'left')" class="w-6 h-full flex items-center justify-center text-[#64748b] hover:text-[#6366f1] hover:bg-slate-50 transition" title="ูุณุงุฑ">
                    <i class="fas fa-align-left text-[10px]"></i>
                </button>
            </div>
        </div>

        <!-- ุฅุนุฏุงุฏุงุช ุงูุชุฏุฑุฌ (ุชุธูุฑ ุนูุฏ ุงูุชูุนูู) -->
        <div id="floating-grad-settings" class="hidden flex-col gap-2 p-2 bg-slate-50 rounded border border-slate-200 shadow-inner mx-2">
            <div class="flex items-center gap-1 justify-between">
                <div class="flex items-center gap-1">
                    <span class="text-[9px] font-bold">ุจุฏุก:</span>
                    <input type="color" id="float-grad-start" value="#6366f1" oninput="syncGradientInputs('start', this.value); updateElementGradient()" class="w-5 h-5 rounded cursor-pointer border-none bg-transparent">
                    <span class="text-[9px] font-bold ml-1">ููุงูุฉ:</span>
                    <input type="color" id="float-grad-end" value="#ec4899" oninput="syncGradientInputs('end', this.value); updateElementGradient()" class="w-5 h-5 rounded cursor-pointer border-none bg-transparent">
                </div>
                <div class="flex items-center gap-1">
                     <span class="text-[9px] font-bold">ุฒุงููุฉ:</span>
                         <input type="range" min="0" max="360" value="90" id="float-grad-angle" oninput="syncGradientInputs('angle', this.value); updateElementGradient()" class="w-10 h-1 accent-[#6366f1]">
                    </div>
                </div>
            </div>
        </div>

        <!-- ุฅุนุฏุงุฏุงุช ุงูุฅุทุงุฑ - ุชู ููููุง ููุดุฑูุท ุงูุนููู -->
        
    </div>

    <!-- ุฒุฑ ููุฅุบูุงู ุงููุฏูู ูููุงูุฐุฉ ุงูุนุงุฆูุฉ - ุชูุช ุฅุฒุงูุชู ูุฏูุฌู ูู ุงููุงูุฐุฉ -->
    <div id="close-floating-toolbar" class="hidden"></div>

    <!-- Footer -->
    <footer class="relative bg-gradient-to-r from-[#3730a3] to-[#312e81] text-white py-4 mt-8 border-t-2 border-[#4338ca] shadow-md overflow-hidden">
        <div class="max-w-7xl mx-auto px-4 relative z-10">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <!-- Column 1: Brand -->
                <div class="flex items-center gap-2">
                    <i class="fas fa-palette text-white text-lg"></i>
                    <div>
                        <h3 class="font-bold text-sm text-white">ุงุณุชูุฏูู ุงููุตูููู</h3>
                        <p class="text-xs text-white text-opacity-80">ูููุดุงุฑูุน ุงูุตุบูุฑู ู ุงูููุฒููุฉ</p>
                    </div>
                </div>
                
                <!-- Column 2: Links & Premium -->
                <div>
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-link text-xs text-pink-300"></i>
                        <h4 class="font-bold text-xs text-white uppercase tracking-wide">ุฑูุงุจุท ุณุฑูุนุฉ</h4>
                    </div>
                    <div class="flex items-center gap-0">
                        <a href="subscriptions.html" class="text-sm font-semibold text-[#fbbf24] hover:text-[#f59e0b] transition flex items-center gap-2 px-3 py-1 no-underline">
                            <i class="fas fa-crown text-[#fbbf24]"></i>
                            PREMIUM
                        </a>
                        <div class="h-5 w-px bg-white bg-opacity-30"></div>
                        <button onclick="toggleLoginOverlay()" class="text-sm font-semibold text-white hover:text-gray-200 transition flex items-center gap-2 px-3 py-1">
                            <i class="fas fa-headset text-pink-300"></i>
                            ุงูุฏุนู ุงูููู
                        </button>
                        <div class="h-5 w-px bg-white bg-opacity-30"></div>
                        <button onclick="toggleLoginOverlay()" class="text-sm font-semibold text-white hover:text-gray-200 transition flex items-center gap-2 px-3 py-1">
                            <i class="fas fa-user-circle text-pink-300"></i>
                            ุฏุฎูู ุงููุดุชุฑููู
                        </button>
                    </div>
                </div>
                
                <!-- Column 3: Contact -->
                <div>
                    <div class="flex items-center gap-2 mb-2">
                        <i class="fas fa-comments text-xs text-white"></i>
                        <h4 class="font-bold text-xs text-white">ุชูุงุตู ูุนูุง</h4>
                    </div>
                    <div class="flex items-center gap-2">
                        <a href="https://wa.me/966531333714" target="_blank" title="00966531333714" class="flex items-center justify-center w-8 h-8 bg-white bg-opacity-25 rounded-lg hover:bg-opacity-40 transition group border border-white border-opacity-30">
                            <i class="fab fa-whatsapp text-sm text-white group-hover:scale-110 transition-transform"></i>
                        </a>
                        <a href="https://x.com/sdr_10" target="_blank" title="@sdr_10" class="flex items-center justify-center w-8 h-8 bg-white bg-opacity-25 rounded-lg hover:bg-opacity-40 transition group border border-white border-opacity-30">
                            <i class="fab fa-x-twitter text-sm text-white group-hover:scale-110 transition-transform"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- Bottom -->
            <div class="border-t border-white border-opacity-30 mt-3 pt-3 text-center text-xs text-white text-opacity-85">
                <p>ยฉ ุฌููุน ุงูุญููู ูุญููุธุฉ ยฉ despro.net 2026</p>
            </div>
        </div>
    </footer>

    <script src="js/app.js?v=1769353051"></script>
</body>
</html>