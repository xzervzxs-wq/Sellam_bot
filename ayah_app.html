<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=4.0, user-scalable=yes, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0a">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ÿ¢Ÿäÿ© - ŸÖÿµÿ≠ŸÅ ÿßŸÑŸÖÿØŸäŸÜÿ©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        :root {
            --bg: #0a0a0a;
            --accent: #c9a227;
            --highlight: rgba(201, 162, 39, 0.5);
        }

        html, body {
            height: 100%;
            background: var(--bg);
            overflow: hidden;
            user-select: none;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* ===== NIGHT MODE ===== */
        body.night-mode {
            --bg: #000;
        }
        body.night-mode .page-img {
            filter: invert(1) hue-rotate(180deg) brightness(0.9);
        }

        /* ===== MUSHAF ===== */
        .mushaf {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .page-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            width: 100%;
        }

        .page-container {
            position: relative;
        }

        .page-img {
            display: block;
            max-width: 100vw;
            max-height: calc(100vh - 70px);
            width: auto;
            height: auto;
        }

        /* ===== AYAH LINES OVERLAY ===== */
        .lines-overlay {
            position: absolute;
            top: 2%;
            bottom: 2%;
            left: 8%;
            right: 8%;
            display: flex;
            flex-direction: column;
        }

        .line-touch {
            flex: 1;
            position: relative;
        }

        /* ===== HIGHLIGHT ===== */
        .line-highlight {
            position: absolute;
            top: 2px;
            left: 0;
            right: 0;
            bottom: 2px;
            background: var(--highlight);
            border: 2px solid var(--accent);
            border-radius: 8px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.15s;
            box-shadow: 0 0 15px rgba(201, 162, 39, 0.4);
        }

        .line-touch.active .line-highlight {
            opacity: 1;
        }

        /* ===== BOTTOM BAR (ÿØÿßÿ¶ŸÖÿßŸã ÿ∏ÿßŸáÿ±) ===== */
        .bottom-simple {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            padding: 12px 20px;
            padding-bottom: max(12px, env(safe-area-inset-bottom));
            background: transparent;
        }

        .simple-btn {
            width: 44px;
            height: 44px;
            border-radius: 22px;
            background: rgba(50,50,50,0.6);
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .simple-btn.active {
            background: var(--accent);
            color: #000;
        }

        /* ===== FLOATING ACTIONS ===== */
        .floating-actions {
            position: fixed;
            display: flex;
            gap: 6px;
            padding: 6px 10px;
            background: rgba(40, 40, 40, 0.98);
            border-radius: 30px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.6);
            border: 1px solid rgba(201, 162, 39, 0.3);
            z-index: 100;
            opacity: 0;
            transform: translateY(10px) scale(0.9);
            pointer-events: none;
            transition: all 0.2s ease;
        }

        .floating-actions.visible {
            opacity: 1;
            transform: translateY(0) scale(1);
            pointer-events: auto;
        }

        .action-icon {
            width: 48px;
            height: 48px;
            border-radius: 24px;
            background: transparent;
            border: none;
            color: var(--accent);
            font-size: 22px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .action-icon:active {
            background: rgba(201, 162, 39, 0.25);
            transform: scale(0.95);
        }

        .action-close {
            width: 28px;
            height: 28px;
            border-radius: 14px;
            background: rgba(255,255,255,0.15);
            border: none;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: -4px;
            margin-right: 4px;
        }

        .action-close:active {
            background: rgba(255,255,255,0.3);
        }

        /* ===== FULL MENU (Ÿäÿ∏Ÿáÿ± ÿ®ÿ∂ÿ∫ÿ∑ÿ™ŸäŸÜ) ===== */
        .full-menu {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 16px;
            padding-top: max(16px, env(safe-area-inset-top));
            background: linear-gradient(to bottom, rgba(0,0,0,0.9), transparent);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 50;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            pointer-events: none;
        }

        .full-menu.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .menu-btn {
            width: 44px;
            height: 44px;
            border-radius: 22px;
            background: rgba(60,60,60,0.9);
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }

        .page-info {
            text-align: center;
        }

        .surah-name {
            color: var(--accent);
            font-size: 18px;
            font-weight: 600;
        }

        .page-num {
            color: rgba(255,255,255,0.7);
            font-size: 13px;
            margin-top: 4px;
        }

        .full-nav {
            position: fixed;
            bottom: 70px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 20px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            pointer-events: none;
            z-index: 50;
        }

        .full-nav.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }

        .nav-btn {
            width: 56px;
            height: 56px;
            border-radius: 28px;
            background: rgba(60,60,60,0.9);
            border: none;
            color: #fff;
            font-size: 22px;
            cursor: pointer;
        }

        /* ===== TAFSIR MODAL ===== */
        .tafsir-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            z-index: 200;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
        }

        .tafsir-overlay.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .tafsir-modal {
            background: #252525;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 85vh;
            display: flex;
            flex-direction: column;
            transform: scale(0.9);
            transition: transform 0.3s;
            border: 1px solid rgba(201, 162, 39, 0.2);
        }

        .tafsir-overlay.visible .tafsir-modal {
            transform: scale(1);
        }

        .tafsir-header {
            padding: 16px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .tafsir-title {
            color: var(--accent);
            font-size: 17px;
            font-weight: 600;
        }

        .tafsir-close {
            width: 36px;
            height: 36px;
            border-radius: 18px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .tafsir-ayah {
            padding: 20px;
            background: rgba(201, 162, 39, 0.1);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .tafsir-ayah-text {
            font-family: 'Amiri', serif;
            font-size: 24px;
            line-height: 1.9;
            color: #fff;
            text-align: center;
        }

        .tafsir-ayah-ref {
            color: var(--accent);
            font-size: 14px;
            text-align: center;
            margin-top: 10px;
        }

        .tafsir-content {
            padding: 20px;
            overflow-y: auto;
            flex: 1;
        }

        .tafsir-text {
            color: #ddd;
            font-size: 17px;
            line-height: 2;
            text-align: justify;
        }

        .tafsir-loading {
            color: #888;
            text-align: center;
            padding: 40px;
        }

        /* ===== INDEX ===== */
        .index-panel {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 300;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
        }

        .index-panel.visible {
            transform: translateX(0);
        }

        .index-header {
            padding: 16px;
            padding-top: max(16px, env(safe-area-inset-top));
            border-bottom: 1px solid rgba(255,255,255,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .index-title {
            color: #fff;
            font-size: 19px;
            font-weight: 600;
        }

        .index-close {
            width: 38px;
            height: 38px;
            border-radius: 19px;
            background: rgba(255,255,255,0.1);
            border: none;
            color: #fff;
            font-size: 18px;
            cursor: pointer;
        }

        .index-list {
            height: calc(100% - 70px);
            overflow-y: auto;
            padding: 8px 16px;
        }

        .surah-row {
            display: flex;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            cursor: pointer;
        }

        .surah-num {
            width: 34px;
            height: 34px;
            background: rgba(201, 162, 39, 0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent);
            font-size: 14px;
            font-weight: 600;
            margin-left: 14px;
        }

        .surah-info { flex: 1; }
        .surah-info-name { color: #fff; font-size: 16px; }
        .surah-info-meta { color: #888; font-size: 12px; margin-top: 3px; }
        .surah-page { color: #666; font-size: 14px; }

        /* ===== PAGE SLIDER ===== */
        .slider-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #2a2a2a;
            padding: 28px;
            padding-bottom: max(28px, env(safe-area-inset-bottom));
            border-radius: 24px 24px 0 0;
            z-index: 300;
            transform: translateY(100%);
            transition: transform 0.3s ease;
        }

        .slider-panel.visible {
            transform: translateY(0);
        }

        .slider-value {
            text-align: center;
            font-size: 48px;
            color: var(--accent);
            margin-bottom: 24px;
        }

        .page-slider {
            width: 100%;
            height: 44px;
            -webkit-appearance: none;
            background: transparent;
            direction: ltr;
        }

        .page-slider::-webkit-slider-runnable-track {
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
        }

        .page-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 28px;
            height: 28px;
            background: var(--accent);
            border-radius: 50%;
            margin-top: -11px;
        }

        .slider-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.6);
            z-index: 250;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .slider-backdrop.visible {
            opacity: 1;
            pointer-events: auto;
        }

        /* ===== TOAST ===== */
        .toast {
            position: fixed;
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%) translateY(50px);
            background: #444;
            color: #fff;
            padding: 14px 28px;
            border-radius: 30px;
            font-size: 15px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 400;
        }

        .toast.visible {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        /* ===== LOADING ===== */
        .loading {
            position: fixed;
            inset: 0;
            background: var(--bg);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 500;
            transition: opacity 0.5s;
        }

        .loading.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-icon {
            font-size: 52px;
            color: var(--accent);
            margin-bottom: 20px;
        }

        .loading-text {
            font-family: 'Amiri', serif;
            font-size: 32px;
            color: #fff;
        }
    </style>
</head>
<body>
    <!-- Mushaf -->
    <div class="mushaf" id="mushaf">
        <div class="page-wrapper">
            <div class="page-container" id="pageContainer">
                <img class="page-img" id="pageImg">
                <div class="lines-overlay" id="linesOverlay"></div>
            </div>
        </div>

        <!-- Bottom Simple Bar (always visible) -->
        <div class="bottom-simple">
            <button class="simple-btn" id="nightBtn" title="ÿßŸÑŸàÿ∂ÿπ ÿßŸÑŸÑŸäŸÑŸä">üåô</button>
            <button class="simple-btn" id="bookmarkBtn" title="ÿπŸÑÿßŸÖÿ© ŸÖÿ±ÿ¨ÿπŸäÿ©">üîñ</button>
        </div>
    </div>

    <!-- Floating Actions (appear near selected ayah) -->
    <div class="floating-actions" id="floatingActions">
        <button class="action-close" id="btnClose" title="ÿ•ÿ∫ŸÑÿßŸÇ">‚úï</button>
        <button class="action-icon" id="btnPlay" title="ÿßÿ≥ÿ™ŸÖÿßÿπ">‚ñ∂Ô∏è</button>
        <button class="action-icon" id="btnTafsir" title="ÿ™ŸÅÿ≥Ÿäÿ±">üìñ</button>
        <button class="action-icon" id="btnCopy" title="ŸÜÿ≥ÿÆ">üìã</button>
    </div>

    <!-- Full Menu (appears on double tap) -->
    <div class="full-menu" id="fullMenu">
        <button class="menu-btn" id="menuBtn">‚ò∞</button>
        <div class="page-info">
            <div class="surah-name" id="surahName">ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©</div>
            <div class="page-num" id="pageNum">ÿµŸÅÿ≠ÿ© Ÿ°</div>
        </div>
        <button class="menu-btn" id="jumpBtn">üìñ</button>
    </div>

    <div class="full-nav" id="fullNav">
        <button class="nav-btn" id="prevBtn">‚Üê</button>
        <button class="nav-btn" id="nextBtn">‚Üí</button>
    </div>

    <!-- Tafsir Modal -->
    <div class="tafsir-overlay" id="tafsirOverlay">
        <div class="tafsir-modal">
            <div class="tafsir-header">
                <div class="tafsir-title">üìñ ÿ™ŸÅÿ≥Ÿäÿ± ÿßŸÑÿ¨ŸÑÿßŸÑŸäŸÜ</div>
                <button class="tafsir-close" id="tafsirClose">‚úï</button>
            </div>
            <div class="tafsir-ayah">
                <div class="tafsir-ayah-text" id="tafsirAyahText"></div>
                <div class="tafsir-ayah-ref" id="tafsirAyahRef"></div>
            </div>
            <div class="tafsir-content">
                <div class="tafsir-text" id="tafsirText">
                    <div class="tafsir-loading">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÅÿ≥Ÿäÿ±...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Index Panel -->
    <div class="index-panel" id="indexPanel">
        <div class="index-header">
            <div class="index-title">ŸÅŸáÿ±ÿ≥ ÿßŸÑÿ≥Ÿàÿ±</div>
            <button class="index-close" id="indexClose">‚úï</button>
        </div>
        <div class="index-list" id="indexList"></div>
    </div>

    <!-- Slider Panel -->
    <div class="slider-backdrop" id="sliderBackdrop"></div>
    <div class="slider-panel" id="sliderPanel">
        <div class="slider-value" id="sliderValue">Ÿ°</div>
        <input type="range" class="page-slider" id="pageSlider" min="1" max="604" value="1">
    </div>

    <!-- Toast -->
    <div class="toast" id="toast"></div>

    <!-- Loading -->
    <div class="loading" id="loading">
        <div class="loading-icon">Ô∑Ω</div>
        <div class="loading-text">ÿ¢Ÿäÿ©</div>
    </div>

    <script>
        // ========== CONFIG ==========
        const CDN = 'https://www.mp3quran.net/api/quran_pages_arabic/';
        const TOTAL = 604;
        const LINES = 15;

        // ========== STATE ==========
        let page = parseInt(localStorage.getItem('ayah_page')) || 1;
        let menuVisible = false;
        let selectedLine = null;
        let ayatData = [];
        let currentAyah = null;
        let nightMode = localStorage.getItem('ayah_night') === 'true';
        let lastTap = 0;

        // ========== SURAHS ==========
        const surahs = [
            {n:1,name:"ÿßŸÑŸÅÿßÿ™ÿ≠ÿ©",p:1,ayat:7,type:"ŸÖŸÉŸäÿ©"},
            {n:2,name:"ÿßŸÑÿ®ŸÇÿ±ÿ©",p:2,ayat:286,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:3,name:"ÿ¢ŸÑ ÿπŸÖÿ±ÿßŸÜ",p:50,ayat:200,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:4,name:"ÿßŸÑŸÜÿ≥ÿßÿ°",p:77,ayat:176,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:5,name:"ÿßŸÑŸÖÿßÿ¶ÿØÿ©",p:106,ayat:120,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:6,name:"ÿßŸÑÿ£ŸÜÿπÿßŸÖ",p:128,ayat:165,type:"ŸÖŸÉŸäÿ©"},
            {n:7,name:"ÿßŸÑÿ£ÿπÿ±ÿßŸÅ",p:151,ayat:206,type:"ŸÖŸÉŸäÿ©"},
            {n:8,name:"ÿßŸÑÿ£ŸÜŸÅÿßŸÑ",p:177,ayat:75,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:9,name:"ÿßŸÑÿ™Ÿàÿ®ÿ©",p:187,ayat:129,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:10,name:"ŸäŸàŸÜÿ≥",p:208,ayat:109,type:"ŸÖŸÉŸäÿ©"},
            {n:11,name:"ŸáŸàÿØ",p:221,ayat:123,type:"ŸÖŸÉŸäÿ©"},
            {n:12,name:"ŸäŸàÿ≥ŸÅ",p:235,ayat:111,type:"ŸÖŸÉŸäÿ©"},
            {n:13,name:"ÿßŸÑÿ±ÿπÿØ",p:249,ayat:43,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:14,name:"ÿ•ÿ®ÿ±ÿßŸáŸäŸÖ",p:255,ayat:52,type:"ŸÖŸÉŸäÿ©"},
            {n:15,name:"ÿßŸÑÿ≠ÿ¨ÿ±",p:262,ayat:99,type:"ŸÖŸÉŸäÿ©"},
            {n:16,name:"ÿßŸÑŸÜÿ≠ŸÑ",p:267,ayat:128,type:"ŸÖŸÉŸäÿ©"},
            {n:17,name:"ÿßŸÑÿ•ÿ≥ÿ±ÿßÿ°",p:282,ayat:111,type:"ŸÖŸÉŸäÿ©"},
            {n:18,name:"ÿßŸÑŸÉŸáŸÅ",p:293,ayat:110,type:"ŸÖŸÉŸäÿ©"},
            {n:19,name:"ŸÖÿ±ŸäŸÖ",p:305,ayat:98,type:"ŸÖŸÉŸäÿ©"},
            {n:20,name:"ÿ∑Ÿá",p:312,ayat:135,type:"ŸÖŸÉŸäÿ©"},
            {n:21,name:"ÿßŸÑÿ£ŸÜÿ®Ÿäÿßÿ°",p:322,ayat:112,type:"ŸÖŸÉŸäÿ©"},
            {n:22,name:"ÿßŸÑÿ≠ÿ¨",p:332,ayat:78,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:23,name:"ÿßŸÑŸÖÿ§ŸÖŸÜŸàŸÜ",p:342,ayat:118,type:"ŸÖŸÉŸäÿ©"},
            {n:24,name:"ÿßŸÑŸÜŸàÿ±",p:350,ayat:64,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:25,name:"ÿßŸÑŸÅÿ±ŸÇÿßŸÜ",p:359,ayat:77,type:"ŸÖŸÉŸäÿ©"},
            {n:26,name:"ÿßŸÑÿ¥ÿπÿ±ÿßÿ°",p:367,ayat:227,type:"ŸÖŸÉŸäÿ©"},
            {n:27,name:"ÿßŸÑŸÜŸÖŸÑ",p:377,ayat:93,type:"ŸÖŸÉŸäÿ©"},
            {n:28,name:"ÿßŸÑŸÇÿµÿµ",p:385,ayat:88,type:"ŸÖŸÉŸäÿ©"},
            {n:29,name:"ÿßŸÑÿπŸÜŸÉÿ®Ÿàÿ™",p:396,ayat:69,type:"ŸÖŸÉŸäÿ©"},
            {n:30,name:"ÿßŸÑÿ±ŸàŸÖ",p:404,ayat:60,type:"ŸÖŸÉŸäÿ©"},
            {n:31,name:"ŸÑŸÇŸÖÿßŸÜ",p:411,ayat:34,type:"ŸÖŸÉŸäÿ©"},
            {n:32,name:"ÿßŸÑÿ≥ÿ¨ÿØÿ©",p:415,ayat:30,type:"ŸÖŸÉŸäÿ©"},
            {n:33,name:"ÿßŸÑÿ£ÿ≠ÿ≤ÿßÿ®",p:418,ayat:73,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:34,name:"ÿ≥ÿ®ÿ£",p:428,ayat:54,type:"ŸÖŸÉŸäÿ©"},
            {n:35,name:"ŸÅÿßÿ∑ÿ±",p:434,ayat:45,type:"ŸÖŸÉŸäÿ©"},
            {n:36,name:"Ÿäÿ≥",p:440,ayat:83,type:"ŸÖŸÉŸäÿ©"},
            {n:37,name:"ÿßŸÑÿµÿßŸÅÿßÿ™",p:446,ayat:182,type:"ŸÖŸÉŸäÿ©"},
            {n:38,name:"ÿµ",p:453,ayat:88,type:"ŸÖŸÉŸäÿ©"},
            {n:39,name:"ÿßŸÑÿ≤ŸÖÿ±",p:458,ayat:75,type:"ŸÖŸÉŸäÿ©"},
            {n:40,name:"ÿ∫ÿßŸÅÿ±",p:467,ayat:85,type:"ŸÖŸÉŸäÿ©"},
            {n:41,name:"ŸÅÿµŸÑÿ™",p:477,ayat:54,type:"ŸÖŸÉŸäÿ©"},
            {n:42,name:"ÿßŸÑÿ¥Ÿàÿ±Ÿâ",p:483,ayat:53,type:"ŸÖŸÉŸäÿ©"},
            {n:43,name:"ÿßŸÑÿ≤ÿÆÿ±ŸÅ",p:489,ayat:89,type:"ŸÖŸÉŸäÿ©"},
            {n:44,name:"ÿßŸÑÿØÿÆÿßŸÜ",p:496,ayat:59,type:"ŸÖŸÉŸäÿ©"},
            {n:45,name:"ÿßŸÑÿ¨ÿßÿ´Ÿäÿ©",p:499,ayat:37,type:"ŸÖŸÉŸäÿ©"},
            {n:46,name:"ÿßŸÑÿ£ÿ≠ŸÇÿßŸÅ",p:502,ayat:35,type:"ŸÖŸÉŸäÿ©"},
            {n:47,name:"ŸÖÿ≠ŸÖÿØ",p:507,ayat:38,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:48,name:"ÿßŸÑŸÅÿ™ÿ≠",p:511,ayat:29,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:49,name:"ÿßŸÑÿ≠ÿ¨ÿ±ÿßÿ™",p:515,ayat:18,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:50,name:"ŸÇ",p:518,ayat:45,type:"ŸÖŸÉŸäÿ©"},
            {n:51,name:"ÿßŸÑÿ∞ÿßÿ±Ÿäÿßÿ™",p:520,ayat:60,type:"ŸÖŸÉŸäÿ©"},
            {n:52,name:"ÿßŸÑÿ∑Ÿàÿ±",p:523,ayat:49,type:"ŸÖŸÉŸäÿ©"},
            {n:53,name:"ÿßŸÑŸÜÿ¨ŸÖ",p:526,ayat:62,type:"ŸÖŸÉŸäÿ©"},
            {n:54,name:"ÿßŸÑŸÇŸÖÿ±",p:528,ayat:55,type:"ŸÖŸÉŸäÿ©"},
            {n:55,name:"ÿßŸÑÿ±ÿ≠ŸÖŸÜ",p:531,ayat:78,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:56,name:"ÿßŸÑŸàÿßŸÇÿπÿ©",p:534,ayat:96,type:"ŸÖŸÉŸäÿ©"},
            {n:57,name:"ÿßŸÑÿ≠ÿØŸäÿØ",p:537,ayat:29,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:58,name:"ÿßŸÑŸÖÿ¨ÿßÿØŸÑÿ©",p:542,ayat:22,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:59,name:"ÿßŸÑÿ≠ÿ¥ÿ±",p:545,ayat:24,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:60,name:"ÿßŸÑŸÖŸÖÿ™ÿ≠ŸÜÿ©",p:549,ayat:13,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:61,name:"ÿßŸÑÿµŸÅ",p:551,ayat:14,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:62,name:"ÿßŸÑÿ¨ŸÖÿπÿ©",p:553,ayat:11,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:63,name:"ÿßŸÑŸÖŸÜÿßŸÅŸÇŸàŸÜ",p:554,ayat:11,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:64,name:"ÿßŸÑÿ™ÿ∫ÿßÿ®ŸÜ",p:556,ayat:18,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:65,name:"ÿßŸÑÿ∑ŸÑÿßŸÇ",p:558,ayat:12,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:66,name:"ÿßŸÑÿ™ÿ≠ÿ±ŸäŸÖ",p:560,ayat:12,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:67,name:"ÿßŸÑŸÖŸÑŸÉ",p:562,ayat:30,type:"ŸÖŸÉŸäÿ©"},
            {n:68,name:"ÿßŸÑŸÇŸÑŸÖ",p:564,ayat:52,type:"ŸÖŸÉŸäÿ©"},
            {n:69,name:"ÿßŸÑÿ≠ÿßŸÇÿ©",p:566,ayat:52,type:"ŸÖŸÉŸäÿ©"},
            {n:70,name:"ÿßŸÑŸÖÿπÿßÿ±ÿ¨",p:568,ayat:44,type:"ŸÖŸÉŸäÿ©"},
            {n:71,name:"ŸÜŸàÿ≠",p:570,ayat:28,type:"ŸÖŸÉŸäÿ©"},
            {n:72,name:"ÿßŸÑÿ¨ŸÜ",p:572,ayat:28,type:"ŸÖŸÉŸäÿ©"},
            {n:73,name:"ÿßŸÑŸÖÿ≤ŸÖŸÑ",p:574,ayat:20,type:"ŸÖŸÉŸäÿ©"},
            {n:74,name:"ÿßŸÑŸÖÿØÿ´ÿ±",p:575,ayat:56,type:"ŸÖŸÉŸäÿ©"},
            {n:75,name:"ÿßŸÑŸÇŸäÿßŸÖÿ©",p:577,ayat:40,type:"ŸÖŸÉŸäÿ©"},
            {n:76,name:"ÿßŸÑÿ•ŸÜÿ≥ÿßŸÜ",p:578,ayat:31,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:77,name:"ÿßŸÑŸÖÿ±ÿ≥ŸÑÿßÿ™",p:580,ayat:50,type:"ŸÖŸÉŸäÿ©"},
            {n:78,name:"ÿßŸÑŸÜÿ®ÿ£",p:582,ayat:40,type:"ŸÖŸÉŸäÿ©"},
            {n:79,name:"ÿßŸÑŸÜÿßÿ≤ÿπÿßÿ™",p:583,ayat:46,type:"ŸÖŸÉŸäÿ©"},
            {n:80,name:"ÿπÿ®ÿ≥",p:585,ayat:42,type:"ŸÖŸÉŸäÿ©"},
            {n:81,name:"ÿßŸÑÿ™ŸÉŸàŸäÿ±",p:586,ayat:29,type:"ŸÖŸÉŸäÿ©"},
            {n:82,name:"ÿßŸÑÿßŸÜŸÅÿ∑ÿßÿ±",p:587,ayat:19,type:"ŸÖŸÉŸäÿ©"},
            {n:83,name:"ÿßŸÑŸÖÿ∑ŸÅŸÅŸäŸÜ",p:587,ayat:36,type:"ŸÖŸÉŸäÿ©"},
            {n:84,name:"ÿßŸÑÿßŸÜÿ¥ŸÇÿßŸÇ",p:589,ayat:25,type:"ŸÖŸÉŸäÿ©"},
            {n:85,name:"ÿßŸÑÿ®ÿ±Ÿàÿ¨",p:590,ayat:22,type:"ŸÖŸÉŸäÿ©"},
            {n:86,name:"ÿßŸÑÿ∑ÿßÿ±ŸÇ",p:591,ayat:17,type:"ŸÖŸÉŸäÿ©"},
            {n:87,name:"ÿßŸÑÿ£ÿπŸÑŸâ",p:591,ayat:19,type:"ŸÖŸÉŸäÿ©"},
            {n:88,name:"ÿßŸÑÿ∫ÿßÿ¥Ÿäÿ©",p:592,ayat:26,type:"ŸÖŸÉŸäÿ©"},
            {n:89,name:"ÿßŸÑŸÅÿ¨ÿ±",p:593,ayat:30,type:"ŸÖŸÉŸäÿ©"},
            {n:90,name:"ÿßŸÑÿ®ŸÑÿØ",p:594,ayat:20,type:"ŸÖŸÉŸäÿ©"},
            {n:91,name:"ÿßŸÑÿ¥ŸÖÿ≥",p:595,ayat:15,type:"ŸÖŸÉŸäÿ©"},
            {n:92,name:"ÿßŸÑŸÑŸäŸÑ",p:595,ayat:21,type:"ŸÖŸÉŸäÿ©"},
            {n:93,name:"ÿßŸÑÿ∂ÿ≠Ÿâ",p:596,ayat:11,type:"ŸÖŸÉŸäÿ©"},
            {n:94,name:"ÿßŸÑÿ¥ÿ±ÿ≠",p:596,ayat:8,type:"ŸÖŸÉŸäÿ©"},
            {n:95,name:"ÿßŸÑÿ™ŸäŸÜ",p:597,ayat:8,type:"ŸÖŸÉŸäÿ©"},
            {n:96,name:"ÿßŸÑÿπŸÑŸÇ",p:597,ayat:19,type:"ŸÖŸÉŸäÿ©"},
            {n:97,name:"ÿßŸÑŸÇÿØÿ±",p:598,ayat:5,type:"ŸÖŸÉŸäÿ©"},
            {n:98,name:"ÿßŸÑÿ®ŸäŸÜÿ©",p:598,ayat:8,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:99,name:"ÿßŸÑÿ≤ŸÑÿ≤ŸÑÿ©",p:599,ayat:8,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:100,name:"ÿßŸÑÿπÿßÿØŸäÿßÿ™",p:599,ayat:11,type:"ŸÖŸÉŸäÿ©"},
            {n:101,name:"ÿßŸÑŸÇÿßÿ±ÿπÿ©",p:600,ayat:11,type:"ŸÖŸÉŸäÿ©"},
            {n:102,name:"ÿßŸÑÿ™ŸÉÿßÿ´ÿ±",p:600,ayat:8,type:"ŸÖŸÉŸäÿ©"},
            {n:103,name:"ÿßŸÑÿπÿµÿ±",p:601,ayat:3,type:"ŸÖŸÉŸäÿ©"},
            {n:104,name:"ÿßŸÑŸáŸÖÿ≤ÿ©",p:601,ayat:9,type:"ŸÖŸÉŸäÿ©"},
            {n:105,name:"ÿßŸÑŸÅŸäŸÑ",p:601,ayat:5,type:"ŸÖŸÉŸäÿ©"},
            {n:106,name:"ŸÇÿ±Ÿäÿ¥",p:602,ayat:4,type:"ŸÖŸÉŸäÿ©"},
            {n:107,name:"ÿßŸÑŸÖÿßÿπŸàŸÜ",p:602,ayat:7,type:"ŸÖŸÉŸäÿ©"},
            {n:108,name:"ÿßŸÑŸÉŸàÿ´ÿ±",p:602,ayat:3,type:"ŸÖŸÉŸäÿ©"},
            {n:109,name:"ÿßŸÑŸÉÿßŸÅÿ±ŸàŸÜ",p:603,ayat:6,type:"ŸÖŸÉŸäÿ©"},
            {n:110,name:"ÿßŸÑŸÜÿµÿ±",p:603,ayat:3,type:"ŸÖÿØŸÜŸäÿ©"},
            {n:111,name:"ÿßŸÑŸÖÿ≥ÿØ",p:603,ayat:5,type:"ŸÖŸÉŸäÿ©"},
            {n:112,name:"ÿßŸÑÿ•ÿÆŸÑÿßÿµ",p:604,ayat:4,type:"ŸÖŸÉŸäÿ©"},
            {n:113,name:"ÿßŸÑŸÅŸÑŸÇ",p:604,ayat:5,type:"ŸÖŸÉŸäÿ©"},
            {n:114,name:"ÿßŸÑŸÜÿßÿ≥",p:604,ayat:6,type:"ŸÖŸÉŸäÿ©"}
        ];

        // ========== HELPERS ==========
        const $ = id => document.getElementById(id);
        const toAr = n => n.toString().replace(/\d/g, d => 'Ÿ†Ÿ°Ÿ¢Ÿ£Ÿ§Ÿ•Ÿ¶ŸßŸ®Ÿ©'[d]);
        const imgUrl = p => CDN + String(p).padStart(3, '0') + '.png';
        const getSurah = () => surahs.filter(s => page >= s.p).pop() || surahs[0];

        // ========== NIGHT MODE ==========
        function applyNightMode() {
            document.body.classList.toggle('night-mode', nightMode);
            $('nightBtn').classList.toggle('active', nightMode);
        }

        function toggleNightMode() {
            nightMode = !nightMode;
            localStorage.setItem('ayah_night', nightMode);
            applyNightMode();
        }

        // ========== LOAD PAGE ==========
        function loadPage(p) {
            page = Math.max(1, Math.min(TOTAL, p));
            clearSelection();
            hideMenu();
            
            const img = $('pageImg');
            img.src = imgUrl(page);
            img.onload = () => {
                $('loading').classList.add('hidden');
                buildLines();
            };
            
            updateInfo();
            localStorage.setItem('ayah_page', page);
            ayatData = [];
        }

        function updateInfo() {
            const s = getSurah();
            $('surahName').textContent = s.name;
            $('pageNum').textContent = 'ÿµŸÅÿ≠ÿ© ' + toAr(page);
            $('sliderValue').textContent = toAr(page);
            $('pageSlider').value = page;
        }

        // ========== BUILD LINES ==========
        function buildLines() {
            const overlay = $('linesOverlay');
            overlay.innerHTML = '';
            
            for (let i = 0; i < LINES; i++) {
                const line = document.createElement('div');
                line.className = 'line-touch';
                line.innerHTML = '<div class="line-highlight"></div>';
                line.dataset.line = i + 1;
                line.onclick = (e) => onLineClick(e, i + 1);
                overlay.appendChild(line);
            }
        }

        // ========== LINE CLICK ==========
        async function onLineClick(event, lineNum) {
            event.stopPropagation();
            
            if (selectedLine === lineNum) {
                clearSelection();
                return;
            }
            
            clearSelection();
            hideMenu();
            selectedLine = lineNum;
            
            const lineEl = document.querySelector(`[data-line="${lineNum}"]`);
            lineEl.classList.add('active');
            
            if (ayatData.length === 0) {
                try {
                    const res = await fetch(`https://api.quran.com/api/v4/verses/by_page/${page}?language=ar&words=true&word_fields=line_number&fields=text_uthmani`);
                    const data = await res.json();
                    ayatData = data.verses;
                } catch (e) {
                    toast('ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ®ŸäÿßŸÜÿßÿ™');
                    return;
                }
            }
            
            const ayah = ayatData.find(a => a.words?.some(w => w.line_number === lineNum));
            if (ayah) {
                currentAyah = ayah;
                
                const lines = new Set();
                ayah.words?.forEach(w => w.line_number && lines.add(w.line_number));
                lines.forEach(ln => {
                    document.querySelector(`[data-line="${ln}"]`)?.classList.add('active');
                });
                
                showFloatingActions(event, lineNum);
            }
        }

        // ========== SHOW FLOATING ACTIONS ==========
        function showFloatingActions(event, lineNum) {
            const actions = $('floatingActions');
            const container = $('pageContainer');
            const rect = container.getBoundingClientRect();
            
            const lineEl = document.querySelector(`[data-line="${lineNum}"]`);
            const lineRect = lineEl.getBoundingClientRect();
            
            let top = lineRect.top - 65;
            let left = rect.left + rect.width / 2;
            
            if (top < 70) {
                top = lineRect.bottom + 15;
            }
            
            actions.style.left = left + 'px';
            actions.style.top = top + 'px';
            actions.style.transform = 'translateX(-50%)';
            actions.classList.add('visible');
        }

        // ========== CLEAR SELECTION ==========
        function clearSelection() {
            selectedLine = null;
            currentAyah = null;
            document.querySelectorAll('.line-touch').forEach(l => l.classList.remove('active'));
            $('floatingActions').classList.remove('visible');
        }

        // ========== MENU (Double Tap) ==========
        function toggleMenu() {
            if (selectedLine) {
                clearSelection();
                return;
            }
            menuVisible = !menuVisible;
            $('fullMenu').classList.toggle('visible', menuVisible);
            $('fullNav').classList.toggle('visible', menuVisible);
        }

        function hideMenu() {
            menuVisible = false;
            $('fullMenu').classList.remove('visible');
            $('fullNav').classList.remove('visible');
        }

        // ========== DOUBLE TAP DETECTION ==========
        function handleTap(event) {
            const now = Date.now();
            const timeDiff = now - lastTap;
            lastTap = now;
            
            if (timeDiff < 300 && timeDiff > 0) {
                // Double tap
                toggleMenu();
            }
        }

        // ========== TAFSIR ==========
        async function showTafsir() {
            if (!currentAyah) return;
            
            const [sNum, vNum] = currentAyah.verse_key.split(':');
            const surah = surahs.find(s => s.n == sNum);
            
            $('tafsirAyahText').textContent = currentAyah.text_uthmani;
            $('tafsirAyahRef').textContent = `ÿ≥Ÿàÿ±ÿ© ${surah.name} - ÿßŸÑÿ¢Ÿäÿ© ${toAr(vNum)}`;
            $('tafsirText').innerHTML = '<div class="tafsir-loading">ÿ¨ÿßÿ±Ÿä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÅÿ≥Ÿäÿ±...</div>';
            
            $('tafsirOverlay').classList.add('visible');
            
            try {
                const res = await fetch(`https://api.quran.com/api/v4/tafsirs/74/by_ayah/${currentAyah.verse_key}`);
                const data = await res.json();
                if (data.tafsir?.text) {
                    $('tafsirText').textContent = data.tafsir.text.replace(/<[^>]*>/g, '');
                } else {
                    $('tafsirText').textContent = 'ÿßŸÑÿ™ŸÅÿ≥Ÿäÿ± ÿ∫Ÿäÿ± ŸÖÿ™ŸàŸÅÿ±';
                }
            } catch (e) {
                $('tafsirText').textContent = 'ÿÆÿ∑ÿ£ ŸÅŸä ÿ™ÿ≠ŸÖŸäŸÑ ÿßŸÑÿ™ŸÅÿ≥Ÿäÿ±';
            }
        }

        function closeTafsir() {
            $('tafsirOverlay').classList.remove('visible');
        }

        // ========== PLAY AYAH ==========
        function playAyah() {
            if (!currentAyah) return;
            const audio = new Audio(`https://cdn.islamic.network/quran/audio/128/ar.alafasy/${currentAyah.id}.mp3`);
            audio.play();
            toast('ÿ¨ÿßÿ±Ÿä ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ‚ñ∂');
        }

        // ========== BOOKMARK ==========
        function addBookmark() {
            localStorage.setItem('ayah_bookmark', page);
            toast('ÿ™ŸÖ ÿ≠ŸÅÿ∏ ÿßŸÑÿπŸÑÿßŸÖÿ© ‚úì');
            $('bookmarkBtn').classList.add('active');
        }

        // ========== COPY ==========
        function copyAyah() {
            if (!currentAyah) return;
            navigator.clipboard?.writeText(currentAyah.text_uthmani);
            toast('ÿ™ŸÖ ŸÜÿ≥ÿÆ ÿßŸÑÿ¢Ÿäÿ© ‚úì');
        }

        // ========== INDEX ==========
        function showIndex() {
            $('indexList').innerHTML = surahs.map(s => `
                <div class="surah-row" onclick="goToPage(${s.p})">
                    <div class="surah-num">${s.n}</div>
                    <div class="surah-info">
                        <div class="surah-info-name">${s.name}</div>
                        <div class="surah-info-meta">${s.type} ¬∑ ${s.ayat} ÿ¢Ÿäÿ©</div>
                    </div>
                    <div class="surah-page">${s.p}</div>
                </div>
            `).join('');
            $('indexPanel').classList.add('visible');
        }

        function closeIndex() {
            $('indexPanel').classList.remove('visible');
        }

        function goToPage(p) {
            loadPage(p);
            closeIndex();
            closeSlider();
        }

        // ========== SLIDER ==========
        function showSlider() {
            $('sliderBackdrop').classList.add('visible');
            $('sliderPanel').classList.add('visible');
        }

        function closeSlider() {
            $('sliderBackdrop').classList.remove('visible');
            $('sliderPanel').classList.remove('visible');
        }

        // ========== TOAST ==========
        function toast(msg) {
            $('toast').textContent = msg;
            $('toast').classList.add('visible');
            setTimeout(() => $('toast').classList.remove('visible'), 2000);
        }

        // ========== NAVIGATION (ÿπŸÉÿ≥ ÿßŸÑÿßÿ™ÿ¨ÿßŸá - ŸäŸÖŸäŸÜ = ÿßŸÑÿ™ÿßŸÑŸäÿå Ÿäÿ≥ÿßÿ± = ÿßŸÑÿ≥ÿßÿ®ŸÇ) ==========
        function next() { loadPage(page - 1); } // ŸÅŸä ÿßŸÑŸÖÿµÿ≠ŸÅ ÿßŸÑÿπÿ±ÿ®Ÿäÿå ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ© ÿπŸÑŸâ ÿßŸÑŸäŸÖŸäŸÜ
        function prev() { loadPage(page + 1); } // ŸàÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ© ÿπŸÑŸâ ÿßŸÑŸäÿ≥ÿßÿ±

        // ========== EVENTS ==========
        $('mushaf').onclick = handleTap;
        $('nightBtn').onclick = (e) => { e.stopPropagation(); toggleNightMode(); };
        $('bookmarkBtn').onclick = (e) => { e.stopPropagation(); addBookmark(); };
        
        $('menuBtn').onclick = (e) => { e.stopPropagation(); showIndex(); };
        $('jumpBtn').onclick = (e) => { e.stopPropagation(); showSlider(); };
        $('indexClose').onclick = closeIndex;
        
        // Navigation buttons (ÿπŸÉÿ≥ ÿßŸÑÿßÿ™ÿ¨ÿßŸá)
        $('prevBtn').onclick = (e) => { e.stopPropagation(); prev(); }; // ‚Üê = ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ© (ÿ±ŸÇŸÖ ÿ£ŸÉÿ®ÿ±)
        $('nextBtn').onclick = (e) => { e.stopPropagation(); next(); }; // ‚Üí = ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ© (ÿ±ŸÇŸÖ ÿ£ÿµÿ∫ÿ±)

        $('btnPlay').onclick = (e) => { e.stopPropagation(); playAyah(); };
        $('btnTafsir').onclick = (e) => { e.stopPropagation(); showTafsir(); };
        $('btnCopy').onclick = (e) => { e.stopPropagation(); copyAyah(); };
        $('btnClose').onclick = (e) => { e.stopPropagation(); clearSelection(); };

        $('tafsirClose').onclick = closeTafsir;
        $('tafsirOverlay').onclick = (e) => { if (e.target === $('tafsirOverlay')) closeTafsir(); };

        $('sliderBackdrop').onclick = closeSlider;
        $('pageSlider').oninput = (e) => { $('sliderValue').textContent = toAr(e.target.value); };
        $('pageSlider').onchange = (e) => { goToPage(parseInt(e.target.value)); };

        // Touch swipe
        let touchStartX = 0;
        $('mushaf').ontouchstart = (e) => { touchStartX = e.touches[0].clientX; };
        $('mushaf').ontouchend = (e) => {
            const diff = e.changedTouches[0].clientX - touchStartX;
            if (Math.abs(diff) > 80) {
                // ÿ≥ÿ≠ÿ® ŸÑŸÑŸäÿ≥ÿßÿ± = ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ™ÿßŸÑŸäÿ© (ÿ±ŸÇŸÖ ÿ£ÿµÿ∫ÿ±)
                // ÿ≥ÿ≠ÿ® ŸÑŸÑŸäŸÖŸäŸÜ = ÿßŸÑÿµŸÅÿ≠ÿ© ÿßŸÑÿ≥ÿßÿ®ŸÇÿ© (ÿ±ŸÇŸÖ ÿ£ŸÉÿ®ÿ±)
                diff < 0 ? next() : prev();
            }
        };

        // Keyboard (ÿπŸÉÿ≥ ÿßŸÑÿßÿ™ÿ¨ÿßŸá)
        document.onkeydown = (e) => {
            if (e.key === 'ArrowLeft') prev();  // Ÿäÿ≥ÿßÿ± = ÿµŸÅÿ≠ÿ© ÿ≥ÿßÿ®ŸÇÿ©
            if (e.key === 'ArrowRight') next(); // ŸäŸÖŸäŸÜ = ÿµŸÅÿ≠ÿ© ÿ™ÿßŸÑŸäÿ©
            if (e.key === 'Escape') { closeTafsir(); closeIndex(); closeSlider(); clearSelection(); hideMenu(); }
        };

        // ========== INIT ==========
        applyNightMode();
        
        // Check if bookmark exists
        const bookmark = localStorage.getItem('ayah_bookmark');
        if (bookmark == page) {
            $('bookmarkBtn').classList.add('active');
        }
        
        loadPage(page);
    </script>
</body>
</html>
